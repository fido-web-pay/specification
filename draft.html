<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="images/favicon.png" sizes="192x192">
<title>FIDO Web Pay</title><style>
.header {font-size:1.6em;margin:1em 0 0.8em 0}
.step {font-size:1.2em;margin-top:1.5em;margin-bottom:0.6em}
.para {margin-top: 0.8em}
.gutter {margin-top: 0.3em}
.actor {color:darkgreen;font-weight:500}
.msg {font-weight:500}
.staticbox {
  font-family: "Noto Mono",monospace;
  margin: 0.8em 0 1em 0;
  box-sizing: border-box;
  word-break: break-all;
  border-width: 1px;
  border-style: solid;
  border-color: grey;
  padding: 10pt;
  box-shadow: 0.2em 0.2em 0.2em #d0d0d0;
  background-color: #f8f8f8;
}
.comment {padding:0.5em 1em;margin-top:1.5em;display:inline-block;background-color:#fafffa}
.box {box-shadow: 0.2em 0.2em 0.2em #d0d0d0;border-width:1px;border-style:solid;border-color:black}
.numbox {border-width:1pt;border-style:solid;border-color:black;border-radius:0.3em;display:inline-block;margin-right:0.6em;padding:0 3pt}
.tftable {border-collapse:collapse;box-shadow:0.2em 0.2em 0.2em #d0d0d0;margin:0.6em 0 1em 0}
.tftable td {background-color: #fffdf2;padding: 0.4em 0.5em;border-width: 1px;border-style: solid; border-color: black}
.tftable th {font-weight: normal;padding: 0.4em 0.5em;background-color: #f8f8f8;text-align: center;border-width: 1px;border-style: solid; border-color: black}
.json {word-break:break-all;background-color:#f8f8f8;padding:1em;border-width:1px;border-style:solid;border-color:#a9a9a9;box-shadow:0.3em 0.3em 0.3em #d0d0d0}
body {margin:1em;font-size:10pt;font-family:Roboto,sans-serif;background-color:white}
code {font-family:"Noto Mono",monospace;color:maroon}
kbd {font-family: "Noto Mono",monospace}
pre {font-family:"Noto Mono",monospace;margin: 0.8em 0 1em 0;padding:0.6em 1em;background-color: #f8f8f8}
ul, ol {margin: 0;padding-left:2em}
li {margin-top:0.3em}
a {color:#4366bf;text-decoration:none;font-weight:500;white-space:nowrap}
.toc {padding: 0 0 0.3em 1em}

</style>
</head>
<body>
<img style="max-width:30%" src="images/fwp.svg" alt="logo" title="FWP logotype">
<img style="max-width:30%;position:absolute;right:1em;top:1em" src="images/ipr.svg" alt="IPR declaration" title="IPR declaration">
<div style="text-align:center" class="header">FIDO Web Pay</div>
<div id="toc" class="header">Table of Contents</div>
<div style='overflow-x:auto;padding-right:0.2em'>
<div class="toc"><a href="#introduction">1 Introduction</a></div>
<div class="toc"><a href="#scope">2 Scope</a></div>
<div class="toc"><a href="#terminology">3 Terminology</a></div>
<div class="toc"><a href="#credentialdatabase">4 Credential Database</a></div>
<div class="toc"><a href="#enrollment">5 Enrollment</a></div>
<div class="toc"><a href="#operation">6 Detailed Operation</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-1">1: Initiate PaymentRequest</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-2">2: Show Payment Authorization UI</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-3">3: Perform User Authorization</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-4">4: Create FWP Assertion</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-4.1">4.1 Extract PaymentRequest Core Data (PRCD)</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-4.2">4.2 Create Authorization Data (AD)</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-4.3">4.3 Create Signed Authorization Data (SAD)</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-4.4">4.4 Create Encrypted Signed Authorization Data (ESAD)</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-4.5">4.5 Assemble FWP Assertion</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-5">5: Return FWP Assertion</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-6">6: Process FWP Assertion and Create PSPRequest Object</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-7">7: Send PSPRequest Object</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-8">8: Process PSPRequest and Create IssuerRequest Object</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-9">9: Send IssuerRequest Object</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-10">10: Process IssuerRequest</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-10.1">10.1 Core Validation</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-10.2">10.2 Extract Signed Authorization Data (SAD)</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-10.3">10.3 Validate Request Data</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-10.4">10.4 Validate Authorization Signature</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-10.5">10.5 Replay Handling</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-10.6">10.6 Other Validation Steps</a></div>
<div class="toc"><a href="#delegatedauthorization">8 Delegated Authorization</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-D1">D1: Process PSPRequest and Create AuthorizeRequest Object</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-D2">D2: Send AuthorizeRequest Object</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-D3">D3: Process AuthorizeRequest</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-D4">D4: Return Authorized Data</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-D5">D5: Create Payment Instruction</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-D6">D6: Invoke &quot;Payment Rails&quot;</a></div>
<div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq-D7">D7: Process Payment Instruction</a></div>
<div class="toc"><a href="#security">Security and Privacy Considerations</a></div>
<div class="toc"><a href="#integration">Integration</a></div>
<div class="toc"><a href="#extensions">Extensions</a></div>
<div class="toc"><a href="#implementationoptions">Implementation Options</a></div>
<div class="toc"><a href="#cbor">Usage of CBOR</a></div>
<div class="toc"><a href="#acknowledgements">Acknowledgements</a></div>
<div class="toc"><a href="#documenthistory">Document History</a></div>
<div class="toc"><a href="#authors">Authors</a></div>
<div class="toc"><a href="#trademarks">Trademarks</a></div>
<div id="introduction" class="header">1. Introduction</div>
</div>
  <div>
    <a href="https://www.emvco.com/" title="EMVCo Site">EMV&reg;<img src="images/xtl.svg" alt="link"></a> represents
    the current &quot;Gold Standard&quot; for <i>secure and convenient payments</i>
    in the physical world.
  </div>
  <div class="para">
    This document describes FIDO&reg; Web Pay (FWP), which is a <a href="#implementationoptions">Web-adapted</a> version of EMV,
    combining the technology underpinning <a href="https://fidoalliance.org/fido2/"
                             title="FIDO2 Technology">FIDO2<img src="images/xtl.svg" alt="link"></a>
    with the W3C
    <a href="https://www.w3.org/TR/payment-request/"
       title="PaymentRequest">PaymentRequest<img src="images/xtl.svg" alt="link"></a> API and
    a browser-resident (<i>built-in</i>) payment application.
  </div>
  <div class="para">
    Apart from obvious data format differences (CBOR/JSON/JavaScript versus ISO7816),
    this specification introduces two major enhancements to EMV:
<ol>
  <li>
    By separating account numbers from issuer (bank branch) identifiers,
    FWP can be used with virtually any account-based payment system,
    including the eurozone's
    <a href="https://www.europeanpaymentscouncil.eu/"
       title="European Payments Council">SEPA Instant<img src="images/xtl.svg" alt="link"></a>.
  </li>
  <li>
    Through <i>encryption of user-authorizations</i>, 
    FWP enables additional security and privacy features:
    <ul>
      <li>
        Obviating the need for external <i>tokenization services</i>.
      </li>
      <li>
        Limiting the amount of personally identifiable information (PII) shared
        with <i>third parties</i> like merchants, to the name of the user's bank and payment network,
        making FWP intrinsically compliant with
        <a href="https://www.pcisecuritystandards.org"
           title="PCI Site">PCI<img src="images/xtl.svg" alt="link"></a>
        requirements as well as with <a href="https://gdprinfo.eu/"
                                        title="GDPR Site">GDPR<img src="images/xtl.svg" alt="link"></a>.
      </li>
    </ul>
  </li>
</ol>
 </div>
  <div class="comment box">
    Since changes in payment systems typically require updating multiple 
    &quot;backend&quot; components and services,
    FWP was designed from the ground-up to keep the complexity of
<i>matching backends</i> at a <a href="https://fido-web-pay.github.io/specification/backend-infrastructure-requirements.pdf"
   title="Backends">comparatively modest level<img src="images/xtl.svg" alt="link"></a>.
  </div>
  <div id="scope" class="header">
    2. Scope
  </div>
  <div>
    Note that FWP is not a payment system, it is a universal <i>payment authorization</i> method,
    exclusively dealing with the <i>user's</i> part of the payment process.
    That is, <i>the backend infrastructure and associated APIs are out of scope for this specification</i>.
    See also <a href="#integration">Integration</a>.
  </div>
  <div class="para">
    However, to guide implementers, this document outlines
    a sample infrastructure at a &quot;conceptual&quot; level.
    Note though that regardless of backend design, FWP assertions
    must (due to the EMV <i>end-to-end security model</i>),
    always be routed back to the designated issuer &quot;verbatim&quot;
    (together with other required data) in order to initiate a payment transaction.
  </div>
  <div id="terminology" class="header">
    3. Terminology
  </div>
  <div>
    Throughout the rest of this document, actor names are
    written as <span class="actor">Name</span>.
    The <span class="actor">Browser</span> actor is in this specification
    considered to be equivalent to &quot;User Agent&quot;.
    A <span class="actor">PSP</span> (Payment System Provider) is in this specification
    denoting any service or network acting as a <i>trusted intermediary</i> between
    a <span class="actor">Merchant</span> and an <span class="actor">Issuer</span>.
    In FWP objects, <span class="actor">Merchant</span> is referred to as &quot;payee&quot;.
  </div>
  <div class="para">
    In this document <a href="#cbor">CBOR</a> primitives are expressed in
    CDDL [<a href="https://tools.ietf.org/html/rfc8610"
             title="RFC8610">RFC8610<img src="images/xtl.svg" alt="link"></a>]
    notation.
  </div>
  <div id="credentialdatabase" class="header">
    4. Credential Database
  </div>
  <div>
    The steps outlined in <a href="#operation">Detailed Operation</a>
    depend on that the <span class="actor">User</span> already have received
    one or more FWP credentials
    (&quot;Virtual Cards&quot;) in an <a href="#enrollment">Enrollment</a> process.
    FWP credentials are stored in a local database in the client device, where each entry is
    supposed to contain the following <a href="#cbor">CBOR</a> attributes:
</div>
<div style='overflow-x:auto;padding-right:0.2em'>
  <table class="tftable">
    <tr><th>Name</th><th>Label</th><th>Type</th><th style="min-width:30em">Description</th></tr>
    <tr>
      <td><code>version</code></td>
      <td style='text-align:center'><kbd>1</kbd></td>
      <td><kbd>tstr</kbd></td>
      <td>
        Since credential data may evolve over time, versioning is necessary.
        This specification covers version 
        <kbd style='white-space:nowrap'>&quot;https://fido-web-pay.github.io/ns/w1&quot;</kbd>
        which is compatible with FWP assertions of the type described here 
        (<kbd style='white-space:nowrap'>&quot;https://fido-web-pay.github.io/ns/p1&quot;</kbd>).
      </td>
    </tr>
    <tr>
      <td><code>credentialId</code></td>
      <td style='text-align:center'><kbd>2</kbd></td>
      <td><kbd>bstr</kbd></td>
      <td>
        FIDO key identifier for creating FWP <a href="#seq-4.3">signatures</a>.
      </td>
    </tr>
    <tr>
      <td><code>rpId</code></td>
      <td style='text-align:center'><kbd>3</kbd></td>
      <td><kbd>tstr</kbd></td>
      <td>
        FIDO relying party (domain) identifier for maintaining
        <span class="actor">Issuer</span> isolation.
      </td>
    </tr>
    <tr>
      <td><code>publicKey</code></td>
      <td style='text-align:center'><kbd>4</kbd></td>
      <td><kbd>map</kbd></td>
      <td>
        COSE compliant FIDO public key matching the private key associated with
        <code>credentialId</code> and <code>rpId</code>.
      </td>
    </tr>
    <tr>
      <td><code>signatureAlgorithm</code></td>
      <td style='text-align:center'><kbd>5</kbd></td>
      <td><kbd>int</kbd></td>
      <td>
        FIDO key/signature algorithm for FWP <a href="#seq-4.3">signatures</a>.
      </td>
    </tr>
    <tr>
      <td><code>encryptionKey</code></td>
      <td style='text-align:center'><kbd>6</kbd></td>
      <td><kbd>map</kbd></td>
      <td>
        COSE compliant <span class="actor">Issuer</span> specific
        (<i>shared</i>) public encryption key. See FWP <a href="#seq-4.4">encryption</a>.
      </td>
    </tr>
    <tr>
      <td><code>encryptionKeyId</code></td>
      <td style='text-align:center'><kbd>7</kbd></td>
      <td><i>&quot;Any&quot;</i></td>
      <td>
        <i>Optional</i>. See FWP <a href="#seq-4.4">encryption</a>.
      </td>
    </tr>
    <tr>
      <td><code>contentEncryptionAlgorithm</code></td>
      <td style='text-align:center'><kbd>8</kbd></td>
      <td><kbd>int</kbd></td>
      <td>
        COSE compliant content encryption algorithm.  See FWP <a href="#seq-4.4">encryption</a>.
      </td>
    </tr>
    <tr>
      <td><code>keyEncryptionAlgorithm</code></td>
      <td style='text-align:center'><kbd>9</kbd></td>
      <td><kbd>int</kbd></td>
      <td>
        COSE compliant key encryption algorithm.  See FWP <a href="#seq-4.4">encryption</a>.
      </td>
    </tr>
    <tr>
      <td><code>accountId</code></td>
      <td style='text-align:center'><kbd>10</kbd></td>
      <td><kbd>tstr</kbd></td>
      <td>
        Account identifier associated with the credential.
      </td>
    </tr>
    <tr>
      <td><code>paymentNetworkId</code></td>
      <td style='text-align:center'><kbd>11</kbd></td>
      <td><kbd>tstr</kbd></td>
      <td>
        URL or predefined short string identifying the associated payment network.
      </td>
    </tr>
    <tr>
      <td><code>issuerId</code></td>
      <td style='text-align:center'><kbd>12</kbd></td>
      <td><kbd>tstr</kbd></td>
      <td>
        Bank Identification Number (BIN) or URL associated with
        the <span class="actor">Issuer</span>.
        The exact definition is specific for each <code>paymentNetworkId</code>.
        See also <a href="#servicediscovery">Service Discovery</a>.
      </td>
    </tr>
    <tr>
      <td><code>serialNumber</code></td>
      <td style='text-align:center'><kbd>13</kbd></td>
      <td><kbd>tstr</kbd></td>
      <td>
        Text string that (with respect to the <span class="actor">Issuer</span>),
        uniquely identifies the payment credential.
      </td>
    </tr>
    <tr>
      <td><code>cardImage</code></td>
      <td style='text-align:center'><kbd>14</kbd></td>
      <td><kbd>bstr</kbd></td>
      <td>
        UTF-8 encoded SVG image identifying the payment credential for
        the <span class="actor">User</span>.
        The content of such images are entirely <span class="actor">Issuer</span> specific,
        but images MUST adhere to certain (TDB), dimensions in order
        to render properly by the wallet.
      </td>
    </tr>
  </table>
</div>
    <div id="keyprotection" class="comment box">
      Through the use of a dedicated credential database,
      associated FIDO keys can be freely used by the FWP implementation,
      while remaining <i>invisible</i> and <i>protected</i> from
      access by all parties but their respective <span class="actor">Issuer</span>.
    </div>
    <div id="enrollment" class="header">
      5. Enrollment
    </div>
    <div>
      The exact enrollment process is yet to be defined; the assumption is that it
      could be accomplished by extending the existing W3C
      <a href="https://www.w3.org/TR/webauthn-2/"
         title="Web Authentication">Web&nbsp;Authentication<img src="images/xtl.svg" alt="link"></a> enrollment system.
      The extension would enable the <span class="actor">Browser</span>
      to securely distinguish between &quot;ordinary&quot; FIDO keys,
      and those targeted for payments which is required for maintaining
      a <i>database</i> in the <span class="actor">Browser</span> holding FWP credentials.
    </div>
    <div iD="multiplecredentials" class="para">
      It would be great if the enrollment system could handle
      <i>multiple credentials in a single operation</i>, because an <span class="actor">Issuer</span> may want to
      support international card networks as well as national or regional payment networks
      <span style="font-family:Roboto,sans-serif,Segoe UI">&#x1f60e;</span>
    </div>
    <div class="para">
      It MAY be technically feasible using a FIDO key associated with an FWP credential
      for Web Authentication as well, but this would be a deployment decision
      by the <span class="actor">Issuer</span>.
    </div>
    <div id="wallet" class="para box comment">
      FWP effectively forms a browser &quot;Wallet&quot;,
      holding an arbitrary number of payment credentials, each representing a
      specific <span class="actor">Issuer</span>,
      <span class="actor">User</span> account,
      and <code>paymentNetworkId</code>.
    </div>
    <div class="para">
      For details on a preliminary enrollment system you may take a peek at
      <a href='fido-wallet-whitepaper.pdf'>this&nbsp;document<img src="images/xtl.svg" alt="link"></a>.
    </div>
    <div id="operation" class="header">
     6. Detailed Operation
    </div>
    <div>
      This section describes the different steps needed to authorize a payment operation using FWP.
      To improve readability, JSON data is &quot;pretty-printed&quot;,
      while <a href="#cbor">CBOR</a> data is provided in &quot;diagnostic notation&quot;.
    </div>
    <div class="para">
      The foundation for the description is the following sequence diagram <i>sample</i>
      where each step is linked to a <i>clickable</i> number in a box:
    </div>
    <div style="overflow-x:auto;padding:8pt 0">
      <svg style='display:block;width:500pt' class='box' viewBox='0 0 606 481' xmlns='http://www.w3.org/2000/svg'>
    <title>FIDO Web Pay - Sample Sequence Diagram</title>
    <!-- Anders Rundgren 2021 -->
    <defs>
    <filter id='dropShaddow'>
      <feGaussianBlur stdDeviation='1.3'/>
    </filter>
    <marker id='arrowHead' markerWidth='7' markerHeight='5' refX='0' refY='2.5' orient='auto' markerUnits='userSpaceOnUse'>
      <polygon points='0 0, 7 2.5, 0 5' fill='#cc1010'/>
    </marker>
    <marker id='arrowReturnHead' markerWidth='7' markerHeight='5' refX='0' refY='2.5' orient='auto' markerUnits='userSpaceOnUse'>
      <polygon points='0 0, 7 2.5, 0 5' fill='#009000'/>
    </marker>
  </defs>
  <line x1='63' y1='67' x2='63' y2='471' stroke-width='1.2' stroke='black'/>
  <line x1='183' y1='67' x2='183' y2='471' stroke-width='1.2' stroke='black'/>
  <line x1='303' y1='67' x2='303' y2='471' stroke-width='1.2' stroke='black'/>
  <line x1='423' y1='67' x2='423' y2='471' stroke-width='1.2' stroke='black'/>
  <line x1='543' y1='67' x2='543' y2='471' stroke-width='1.2' stroke='black'/>
<svg x='43' y='32.0' width='40' height='40.0'
   xmlns='http://www.w3.org/2000/svg'
   viewBox='0 0 128 128'
   version='1.1'
   id='svg3129'>
  <title>User Symbol</title>
  <defs
     id='defs3131'>
    <linearGradient
       id='e'>
      <stop
         stop-color='#010101'
         offset='0'
         id='stop3134' />
      <stop
         stop-color='#4e4e4e'
         offset='1'
         id='stop3136' />
    </linearGradient>
    <linearGradient
       id='a'>
      <stop
         stop-color='#868aa8'
         stop-opacity='.68627'
         offset='0'
         id='stop3139' />
      <stop
         stop-color='#a0a4bb'
         stop-opacity='.56078'
         offset='1'
         id='stop3141' />
    </linearGradient>
    <linearGradient
       id='b'>
      <stop
         stop-color='#ffe2ba'
         stop-opacity='.547'
         offset='0'
         id='stop3144' />
      <stop
         stop-color='#ffc684'
         offset='1'
         id='stop3146' />
    </linearGradient>
    <linearGradient
       id='c'>
      <stop
         stop-color='#ffedd2'
         offset='0'
         id='stop3149' />
      <stop
         stop-color='#ffd5a5'
         offset='1'
         id='stop3151' />
    </linearGradient>
    <linearGradient
       id='d'>
      <stop
         stop-color='#b3b3b3'
         offset='0'
         id='stop3154' />
      <stop
         stop-color='#ce964d'
         offset='1'
         id='stop3156' />
    </linearGradient>
    <filter
       id='f'>
      <feGaussianBlur
         stdDeviation='0.31388603'
         id='feGaussianBlur3159' />
    </filter>
    <linearGradient
       id='y'
       y2='56.036'
       href='#c'
       gradientUnits='userSpaceOnUse'
       x2='4.8214'
       gradientTransform='translate(41.286,2.5714)'
       y1='38.893'
       x1='3.5714' />
    <linearGradient
       id='x'
       y2='58.036'
       href='#d'
       gradientUnits='userSpaceOnUse'
       x2='8.2344'
       gradientTransform='translate(41.286,2.5714)'
       y1='34.993'
       x1='9.6809' />
    <linearGradient
       id='w'
       y2='55.411'
       href='#b'
       gradientUnits='userSpaceOnUse'
       x2='6.1607'
       gradientTransform='translate(41.286,2.5714)'
       y1='38.536'
       x1='1.7857' />
    <radialGradient
       id='j'
       gradientUnits='userSpaceOnUse'
       cy='20.53'
       cx='3.4889'
       gradientTransform='matrix(1,0,0,0.73258,61.286,8.1921)'
       r='19.097'>
      <stop
         stop-color='#be984f'
         offset='0'
         id='stop3165' />
      <stop
         stop-color='#754c0a'
         offset='1'
         id='stop3167' />
    </radialGradient>
    <linearGradient
       id='v'
       y2='29.25'
       gradientUnits='userSpaceOnUse'
       x2='-7.3214'
       gradientTransform='translate(61.286,2.5714)'
       y1='7.2857'
       x1='-6.7857'>
      <stop
         stop-color='#b47a06'
         offset='0'
         id='stop3170' />
      <stop
         stop-color='#6a410c'
         offset='1'
         id='stop3172' />
    </linearGradient>
    <radialGradient
       id='i'
       gradientUnits='userSpaceOnUse'
       cy='26.852'
       cx='12.304'
       gradientTransform='matrix(-1.3742,-1.1543,1.6293,-1.9396,7.0338,90.784)'
       r='4.8731'>
      <stop
         stop-color='#b37a07'
         offset='0'
         id='stop3175' />
      <stop
         stop-color='#7c4f0b'
         offset='1'
         id='stop3177' />
    </radialGradient>
    <linearGradient
       id='u'
       y2='38.714'
       gradientUnits='userSpaceOnUse'
       x2='10.893'
       gradientTransform='translate(21.286,2.5714)'
       y1='16.214'
       x1='10'>
      <stop
         stop-color='#af7606'
         offset='0'
         id='stop3180' />
      <stop
         stop-color='#6a410b'
         stop-opacity='.96863'
         offset='1'
         id='stop3182' />
    </linearGradient>
    <linearGradient
       id='t'
       y2='100.86'
       gradientUnits='userSpaceOnUse'
       x2='15'
       gradientTransform='translate(81.286,2.5714)'
       y1='79.429'
       x1='-52.143'>
      <stop
         stop-color='#a0a3bb'
         stop-opacity='.95686'
         offset='0'
         id='stop3185' />
      <stop
         stop-color='#d0d1e2'
         offset='1'
         id='stop3187' />
    </linearGradient>
    <linearGradient
       id='s'
       y2='56.929'
       href='#a'
       gradientUnits='userSpaceOnUse'
       x2='-58.571'
       gradientTransform='translate(81.286,2.5714)'
       y1='101.57'
       x1='-16.25' />
    <linearGradient
       id='r'
       y2='90.5'
       gradientUnits='userSpaceOnUse'
       x2='-21.071'
       gradientTransform='translate(81.286,2.5714)'
       y1='72.464'
       x1='-58.214'>
      <stop
         stop-color='#79819d'
         stop-opacity='.82883'
         offset='0'
         id='stop3191' />
      <stop
         stop-color='#e2e2ed'
         stop-opacity='.424'
         offset='1'
         id='stop3193' />
    </linearGradient>
    <radialGradient
       id='h'
       gradientUnits='userSpaceOnUse'
       cy='93.388'
       cx='150.89'
       gradientTransform='matrix(-0.662,0.80825,-0.80978,-0.65231,267.69,34.405)'
       r='14.984'>
      <stop
         stop-color='#ffe3b8'
         offset='0'
         id='stop3196' />
      <stop
         stop-color='#ffcc8a'
         offset='1'
         id='stop3198' />
    </radialGradient>
    <linearGradient
       id='q'
       y2='56.036'
       href='#c'
       gradientUnits='userSpaceOnUse'
       x2='4.8214'
       gradientTransform='translate(81.286,32.571)'
       y1='38.893'
       x1='3.5714' />
    <linearGradient
       id='p'
       y2='55.179'
       href='#d'
       gradientUnits='userSpaceOnUse'
       x2='7.6987'
       gradientTransform='translate(81.286,32.571)'
       y1='34.993'
       x1='9.6809' />
    <linearGradient
       id='o'
       y2='55.411'
       href='#b'
       gradientUnits='userSpaceOnUse'
       x2='6.1607'
       gradientTransform='translate(83.286,32.571)'
       y1='38.536'
       x1='1.7857' />
    <linearGradient
       id='n'
       y2='96.117'
       href='#e'
       gradientUnits='userSpaceOnUse'
       x2='69.827'
       gradientTransform='translate(1.2857,2.5714)'
       y1='105.18'
       x1='68.16' />
    <radialGradient
       id='g'
       gradientUnits='userSpaceOnUse'
       cy='41.346'
       cx='141.71'
       gradientTransform='matrix(-1.0275,0.58941,-0.64296,-1.1208,268.12,14.284)'
       r='28.364'>
      <stop
         stop-color='#b37906'
         offset='0'
         id='stop3205'
         style='stop-color:#c78707;stop-opacity:1;' />
      <stop
         stop-color='#976408'
         offset='0.68349999'
         id='stop3207'
         style='stop-color:#9c6708;stop-opacity:1;' />
      <stop
         stop-color='#74490b'
         offset='1'
         id='stop3209'
         style='stop-color:#774a0b;stop-opacity:1;' />
    </radialGradient>
    <linearGradient
       id='m'
       y2='82.286'
       gradientUnits='userSpaceOnUse'
       x2='122.14'
       gradientTransform='translate(-58.714,2.5714)'
       y1='45.5'
       x1='144.11'>
      <stop
         stop-color='#b77c06'
         offset='0'
         id='stop3212' />
      <stop
         stop-color='#69410c'
         offset='1'
         id='stop3214' />
    </linearGradient>
    <linearGradient
       id='l'
       y2='97.188'
       href='#e'
       gradientUnits='userSpaceOnUse'
       x2='66.077'
       gradientTransform='matrix(-1,0,0,1,172.39,2.5714)'
       y1='106.26'
       x1='66.731' />
    <linearGradient
       id='k'
       y2='56.929'
       href='#a'
       gradientUnits='userSpaceOnUse'
       x2='-58.571'
       gradientTransform='translate(380,2)'
       y1='101.57'
       x1='-16.25' />
    <filter
       id='z'>
      <feGaussianBlur
         stdDeviation='1.0549209'
         id='feGaussianBlur3219' />
    </filter>
    <linearGradient
       href='#c'
       id='linearGradient3279'
       gradientUnits='userSpaceOnUse'
       gradientTransform='matrix(1.6567976,0,0,1.6567976,54.822693,-16.614891)'
       x1='3.5714'
       y1='38.893'
       x2='4.8214'
       y2='56.036' />
    <linearGradient
       href='#d'
       id='linearGradient3281'
       gradientUnits='userSpaceOnUse'
       gradientTransform='matrix(1.6567976,0,0,1.6567976,54.822693,-16.614891)'
       x1='9.6809'
       y1='34.993'
       x2='7.6987'
       y2='55.179' />
    <radialGradient
       href='#h'
       id='radialGradient3284'
       gradientUnits='userSpaceOnUse'
       gradientTransform='matrix(-1.0968002,1.3391068,-1.3416416,-1.0807458,363.65641,-13.576323)'
       cx='150.89'
       cy='93.388'
       r='14.984' />
    <linearGradient
       href='#b'
       id='linearGradient3309'
       gradientUnits='userSpaceOnUse'
       gradientTransform='translate(83.286,32.571)'
       x1='1.7857'
       y1='38.536'
       x2='6.1607'
       y2='55.411' />
    <linearGradient
       href='#e'
       id='linearGradient3312'
       gradientUnits='userSpaceOnUse'
       gradientTransform='matrix(-1.6567977,0,0,1.6567977,205.76359,-66.318157)'
       x1='66.731'
       y1='106.26'
       x2='66.077'
       y2='97.188' />
    <radialGradient
       href='#g'
       id='radialGradient3315'
       gradientUnits='userSpaceOnUse'
       gradientTransform='matrix(-1.7023596,0.97653313,-1.0652546,-1.8569389,364.36884,-46.912749)'
       cx='141.71'
       cy='41.346'
       r='28.364' />
    <linearGradient
       href='#m'
       id='linearGradient3317'
       gradientUnits='userSpaceOnUse'
       gradientTransform='matrix(1.6567977,0,0,1.6567977,-177.12898,-66.318157)'
       x1='144.11'
       y1='45.5'
       x2='122.14'
       y2='82.286' />
    <linearGradient
       href='#e'
       id='linearGradient3320'
       gradientUnits='userSpaceOnUse'
       gradientTransform='matrix(1.6567977,0,0,1.6567977,-77.721618,-66.318157)'
       x1='68.16'
       y1='105.18'
       x2='69.827'
       y2='96.117' />
  </defs>
  <g
     transform='matrix(1.6567977,0,0,1.6567977,-574.75382,-66.318157)'
     id='g3223'
     style='opacity:0.572;filter:url(#z)'>
    <path
       d='m 395.19,79.812 -17.875,1.7812 0.1875,9.9062 -2.25,1.5625 c -0.0214,-0.007 -0.0412,-0.028 -0.0625,-0.0312 -2.33,-0.357 -19.08,5.969 -19.08,5.969 -1.2819,0.56575 -6.2953,10.673 -5.7812,12.25 0.43236,1.326 3.1295,3.25 3.8438,3.25 0.71428,0 26.531,-0.0312 26.531,-0.0312 0,0 1.4e-4,-0.0616 0,-0.0625 l 19.812,0.125 v -0.0625 c 7.5998,0.009 15.965,0.0312 16.406,0.0312 0.71429,0 3.3801,-1.924 3.8125,-3.25 0.51405,-1.5765 -4.4681,-11.684 -5.75,-12.25 0,0 -15.834,-5.9823 -18.812,-5.9688 l -1.7188,-0.625 0.73,-12.595 z'
       id='path3227'/>
    <path
       d='m 379.11,61.429 0.35715,4.6429 9.4643,-13.929 c 0,0 9.6429,6.0714 9.8214,10.714 0.17857,4.6429 0.17857,16.964 0,17.679 -0.18,0.714 -2.68,4.464 -3.93,5.178 -1.25,0.71428 -4.6429,0.35714 -4.6429,0.35714 l 5.1786,1.7857 0.17857,3.2143 c 0,0 5,-0.17857 6.7857,-1.4286 1.7857,-1.25003 7.3214,-4.2857 6.25,-13.929 -1.08,-9.642 -3.58,-22.856 -8.94,-27.32 -5.35,-4.464 -10.89,-5.357 -13.57,-5.536 -2.6786,-0.17857 -8.2143,-1.0714 -12.679,4.2857 -4.4643,5.3571 -6.0714,13.393 -6.0714,15 0,1.6071 -1.6071,12.679 -1.6071,12.679 0,0 -0.35715,1.9643 -2.8572,3.0357 -2.50005,1.0714 -10.179,1.25 -10.179,1.25 2.8992,1.2652 5.9753,1.6709 9.1071,1.4286 0.71429,-0.17857 3.3036,-0.44643 2.0536,0.625 -1.25,1.07143 -6.5179,1.6964 -6.5179,1.6964 0,0 0.26785,4.4643 3.4821,4.8214 3.2143,0.35714 4.0179,0.53571 4.0179,0.53571 0,0 1.1607,-0.17857 0.44643,1.6071 -0.71428,1.7857 -3.4822,2.1429 -3.4822,2.1429 0,0 11.607,1.9643 12.857,1.25 1.25,-0.71429 1.8717,-0.78041 2.3214,-1.6071 0.9107,-1.674 0.17857,-5.7143 0.17857,-5.7143 0,0 -3.5714,-3.2143 -4.2857,-5.8929 -0.71429,-2.6786 -1.9643,-14.821 -1.4286,-16.071 0.53572,-1.25 5.1786,0 5.8929,-0.35714 0.72,-0.359 1.79,-2.144 1.79,-2.144 z'
       id='path3231'/>
  </g>
  <path
     style='fill:url(#radialGradient3284);stroke:#ce954d;stroke-width:1.65015399px'
     id='path3257'
     d='m 50.382477,65.547368 0.29589,16.433115 -9.76467,6.749295 0.887696,31.104722 47.048085,0.29344 -2.071329,-33.745662 -7.989244,-2.93452 1.189581,-20.844172 z' />
  <path
     style='fill:url(#linearGradient3279);stroke:url(#linearGradient3281);stroke-width:1.65679765px'
     id='path3259'
     d='m 39.177556,45.248283 c 0,0 3.080815,16.124783 5.020925,20.501215 1.883944,4.250348 13.179826,13.598167 15.271698,13.598167 2.092038,0 5.217255,1.194501 8.082689,-0.08664 4.855908,-2.171065 15.630394,-11.372092 17.230696,-13.929856 3.545878,-5.66774 2.797502,-30.839634 2.797502,-30.839634 L 69.579959,10.820854 40.011091,28.09297 z' />
  <path
     style='fill:url(#linearGradient3309);filter:url(#f)'
     id='path3261'
     d='m 98.107,80.571 c -2.7223,3.1712 -6.6032,5.2139 -8.0357,5.3571 -3.5714,0.35715 -10.488,-2.8013 -12.679,-7.3214 -1.8706,-3.86 -0.53571,-15.179 -0.53571,-15.179 0,0 4.5247,2.5207 7.7577,6.8598 2.5893,3.4752 3.9658,8.9492 4.3852,9.033 2.2321,0.44643 8.8393,-6.0714 9.0178,-6.7857 0.179,-0.714 3.053,4.58 0.09,8.036 z'
     transform='matrix(1.6567977,0,0,1.6567977,-79.851763,-70.578447)' />
  <path
     d='m 56.005648,120.01956 c 0,0 -5.325444,-34.910384 -9.171535,-35.503518 -3.84609,-0.591708 -28.314672,7.645459 -31.588505,9.90384 -4.734299,3.266377 -10.3877898,17.661468 -9.5361958,20.274238 0.7163331,2.19691 5.1521438,5.37614 6.3355948,5.37614 1.18461,0 43.96147,-0.0497 43.96147,-0.0497 z'
     id='path3265'
     style='fill:url(#linearGradient3320);stroke:#1f1f1f;stroke-width:1.65679765px'/>
  <path
     d='M 53.343174,32.14301 53.9349,39.835356 69.61533,16.757821 c 0,0 13.104939,8.145978 15.958276,17.961344 2.799656,9.629971 0.609652,27.89716 0.313797,29.080113 -0.295854,1.183434 -4.437898,7.396442 -6.508895,8.579893 -2.070997,1.183417 -7.692346,0.591709 -7.692346,0.591709 l 8.579892,2.958543 0.295855,5.325445 c 0,0 8.283988,-0.295854 11.242532,-2.366901 C 94.762984,76.81692 103.93452,71.787429 102.15943,55.810432 100.38433,39.834097 98.183112,22.162527 87.366542,10.545062 81.850897,4.620519 72.972118,1.6217151 64.882141,1.3735268 57.49448,1.1469432 49.253568,3.4032697 43.875603,8.4740647 37.373832,14.605376 33.816521,30.663556 33.816521,33.32603 c 0,2.66264 -2.662639,21.006538 -2.662639,21.006538 0,0 -0.591726,3.254448 -4.733803,5.029541 -4.142077,1.775093 -16.8645435,2.070997 -16.8645435,2.070997 4.8033875,2.096181 9.8998635,2.768343 15.0886225,2.366901 1.183434,-0.295854 5.473397,-0.739644 3.4024,1.035499 -2.070997,1.775143 -10.798842,2.810592 -10.798842,2.810592 0,0 0.443773,7.396442 5.769135,7.988084 5.325445,0.591709 6.656848,0.88758 6.656848,0.88758 0,0 1.923045,-0.295871 0.739644,2.662639 -1.183418,2.958544 -5.769301,3.550352 -5.769301,3.550352 0,0 19.230451,3.254448 21.301448,2.070997 2.070997,-1.183434 3.101028,-1.292998 3.84609,-2.662805 1.508846,-2.773479 0.295854,-9.467439 0.295854,-9.467439 0,0 -5.917087,-5.325445 -7.100537,-9.763343 -1.183434,-4.437899 -3.254448,-24.555399 -2.366902,-26.626396 0.88758,-2.070997 8.579893,0 9.763344,-0.591709 1.18461,-0.593134 2.960697,-3.552174 2.960697,-3.552174 z'
     id='path3267'
     style='fill:url(#radialGradient3315);stroke:url(#linearGradient3317);stroke-width:1.65679765px'/>
  <path
     d='m 72.041793,120.01956 c 0,0 5.325445,-34.910384 9.171535,-35.503518 3.846091,-0.591708 26.000122,6.891119 31.588502,9.90384 5.58822,3.012721 10.38779,17.661468 9.5362,20.274238 -0.71633,2.19691 -5.15214,5.37614 -6.33559,5.37614 -1.17633,0 -43.956505,-0.0497 -43.956505,-0.0497 z'
     id='path3269'
     style='fill:url(#linearGradient3312);stroke:#1f1f1f;stroke-width:1.65679765px'/>
</svg>
  <text x='63' y='24.3' fill='black' font-family='Roboto,sans-serif' font-size='14.399999999999999' text-anchor='middle'>User</text>
<svg x='163' y='32.0' width='40' height='40.0' viewBox='0 0 68 68' xmlns='http://www.w3.org/2000/svg'>
  <title>Browser Symbol</title>
  <!-- Anders Rundgren 2021-->
  <defs>
    <radialGradient id='browserWorld'>
      <stop offset='0.09' stop-color='#afc6e9'/>
      <stop offset='0.5' stop-color='#5070ff'/>
    </radialGradient>
  </defs>
  <circle cx='34' cy='34' r='34' fill='url(#browserWorld)'/>
  <g fill='none' stroke='white' stroke-width='1.5'>
    <circle cx='34' cy='34' r='31'/>
    <ellipse cx='34' cy='34' rx='13' ry='31'/>
    <line x1='34' y1='3.5' x2='34' y2='64.5'/>
    <line x1='3.5' y1='34' x2='64.5' y2='34'/>
    <line x1='7' y1='19' x2='61' y2='19'/>
    <line x1='7' y1='49' x2='61' y2='49'/>
  </g>
</svg>
  <text x='183' y='24.3' fill='black' font-family='Roboto,sans-serif' font-size='14.399999999999999' text-anchor='middle'>Browser</text>
<svg x='274.6666666666667' y='32.0' width='56.666666666666664' height='40.0'
   xmlns='http://www.w3.org/2000/svg'
   viewBox='0 0 68 48'
   version='1.1'>
  <title>Merchant Symbol</title>
  <!-- Anders Rundgren 2021-->
  <defs>
    <filter
       id='fx0'
       x='-128'
       y='-72'
       width='1536'
       height='864.00006'
       filterUnits='userSpaceOnUse'
       primitiveUnits='userSpaceOnUse'>
      <feComponentTransfer
         color-interpolation-filters='sRGB'
         id='feComponentTransfer10'>
        <feFuncR
           type='discrete'
           tableValues='0 0'
           id='feFuncR2' />
        <feFuncG
           type='discrete'
           tableValues='0 0'
           id='feFuncG4' />
        <feFuncB
           type='discrete'
           tableValues='0 0'
           id='feFuncB6' />
        <feFuncA
           type='linear'
           slope='0.4'
           intercept='0'
           id='feFuncA8' />
      </feComponentTransfer>
      <feGaussianBlur
         stdDeviation='1.77778 1.77778'
         id='feGaussianBlur12' />
    </filter>
    <filter
       id='fx1'
       x='-128'
       y='-72'
       width='1536'
       height='864.00006'
       filterUnits='userSpaceOnUse'
       primitiveUnits='userSpaceOnUse'>
      <feComponentTransfer
         color-interpolation-filters='sRGB'
         id='feComponentTransfer23'>
        <feFuncR
           type='discrete'
           tableValues='0 0'
           id='feFuncR15' />
        <feFuncG
           type='discrete'
           tableValues='0 0'
           id='feFuncG17' />
        <feFuncB
           type='discrete'
           tableValues='0 0'
           id='feFuncB19' />
        <feFuncA
           type='linear'
           slope='0.4'
           intercept='0'
           id='feFuncA21' />
      </feComponentTransfer>
      <feGaussianBlur
         stdDeviation='1.77778 1.77778'
         id='feGaussianBlur25' />
    </filter>
    <clipPath
       id='clip2'>
      <rect
         x='0'
         y='0'
         width='1280'
         height='720' />
    </clipPath>
    <clipPath
       id='clip3'>
      <rect
         x='-2'
         y='-2'
         width='73'
         height='46' />
    </clipPath>
    <clipPath
       id='clip4'>
      <rect
         x='0'
         y='0'
         width='69'
         height='44' />
    </clipPath>
    <linearGradient
       x1='291'
       y1='69.000099'
       x2='327'
       y2='105'
       gradientUnits='userSpaceOnUse'
       spreadMethod='reflect'
       id='fill5'
       gradientTransform='translate(-274,-55)'>
      <stop
         offset='0'
         stop-color='#E6E6E6'
         id='stop37' />
      <stop
         offset='0.00625'
         stop-color='#E6E6E6'
         id='stop39' />
      <stop
         offset='0.49'
         stop-color='#FFFFFF'
         id='stop41' />
      <stop
         offset='1'
         stop-color='#F2F2F2'
         id='stop43' />
    </linearGradient>
    <clipPath
       id='clip6'>
      <rect
         x='-2'
         y='-2'
         width='77'
         height='38' />
    </clipPath>
    <clipPath
       id='clip7'>
      <rect
         x='0'
         y='0'
         width='74'
         height='34' />
    </clipPath>
  </defs>
  <g
     clip-path='url(#clip3)'
     filter='url(#fx0)'
     transform='translate(1,12)'>
    <g
       clip-path='url(#clip4)'>
      <rect
         x='12.3285'
         y='7.3284798'
         width='45'
         height='27'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'/>
      <rect
         x='16.328501'
         y='15.3285'
         width='9'
         height='20'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ebf1de'/>
      <rect
         x='0'
         y='0'
         width='14'
         height='22'
         stroke='#8eb4e3'
         stroke-width='2'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#dce6f2'
         transform='matrix(0,-1,-1,0,51.8284,28.8284)'/>
      <path
         d='m 25.3285,25.3285 1e-4,1e-4'
         stroke='#4a7ebb'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='none'
         fill-rule='evenodd'/>
      <rect
         x='7.3284898'
         y='34.328499'
         width='54'
         height='2'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#fdfac7'/>
    </g>
  </g>
  <rect
     x='12.5'
     y='18.500099'
     width='45'
     height='27'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='url(#fill5)'
     style='fill:url(#fill5)' />
  <rect
     x='16.5'
     y='26.500099'
     width='9'
     height='20'
     stroke='#7f7f7f'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ebf1de'/>
  <rect
     x='-40'
     y='-52'
     width='14'
     height='22'
     stroke='#8eb4e3'
     stroke-width='1.66667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#dce6f2'
     transform='matrix(0,-1,-1,0,0,0)' />
  <path
     d='m 25.5,36.5001 v 10e-5'
     stroke='#4a7ebb'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='none'
     fill-rule='evenodd' />
  <g
     clip-path='url(#clip6)'
     filter='url(#fx1)'
     transform='translate(0,-4)'>
    <g
       clip-path='url(#clip7)'>
      <path
         d='m 7.32849,24.8285 c 0,-0.8285 1.567,-1.5 3.50001,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.93301,0 -3.50001,-0.6716 -3.50001,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'
         fill-rule='evenodd' />
      <path
         d='m 20.3285,24.8285 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'
         fill-rule='evenodd' />
      <path
         d='m 33.3285,24.8285 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'
         fill-rule='evenodd' />
      <path
         d='m 46.3285,24.8285 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'
         fill-rule='evenodd' />
      <path
         d='m 59.3285,24.8285 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'
         fill-rule='evenodd' />
      <path
         d='m 14.3285,24.8285 c 0,-0.8285 1.3431,-1.5 3,-1.5 1.6568,0 3,0.6715 3,1.5 0,0.8284 -1.3432,1.5 -3,1.5 -1.6569,0 -3,-0.6716 -3,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff'
         fill-rule='evenodd' />
      <path
         d='m 27.3285,24.8285 c 0,-0.8285 1.3431,-1.5 3,-1.5 1.6568,0 3,0.6715 3,1.5 0,0.8284 -1.3432,1.5 -3,1.5 -1.6569,0 -3,-0.6716 -3,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff'
         fill-rule='evenodd' />
      <path
         d='m 40.3285,24.8285 c 0,-0.8285 1.3431,-1.5 3,-1.5 1.6568,0 3,0.6715 3,1.5 0,0.8284 -1.3432,1.5 -3,1.5 -1.6569,0 -3,-0.6716 -3,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff'
         fill-rule='evenodd' />
      <path
         d='m 53.3285,24.8285 c 0,-0.8285 1.3431,-1.5 3,-1.5 1.6568,0 3,0.6715 3,1.5 0,0.8284 -1.3432,1.5 -3,1.5 -1.6569,0 -3,-0.6716 -3,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff'
         fill-rule='evenodd' />
      <path
         d='M 0,17 V 0 l 7,17 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'
         fill-rule='evenodd'
         transform='matrix(-1,0,0,1,14.3285,7.32848)' />
      <rect
         x='20.328501'
         y='7.3284798'
         width='7'
         height='17'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000' />
      <rect
         x='33.328499'
         y='7.3284798'
         width='7'
         height='17'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000' />
      <rect
         x='46.328499'
         y='7.3284798'
         width='7'
         height='17'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000' />
      <path
         d='M 59.3285,24.3285 V 7.32848 l 7,17.00002 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'
         fill-rule='evenodd' />
      <rect
         x='14.3285'
         y='7.3284798'
         width='6'
         height='17'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff' />
      <rect
         x='27.328501'
         y='7.3284798'
         width='6'
         height='17'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff' />
      <rect
         x='40.328499'
         y='7.3284798'
         width='6'
         height='17'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff' />
      <rect
         x='53.328499'
         y='7.3284798'
         width='6'
         height='17'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff' />
    </g>
  </g>
  <path
     d='m 4.5,18.0001 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000'
     fill-rule='evenodd' />
  <path
     d='m 17.5,18.0001 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000'
     fill-rule='evenodd' />
  <path
     d='m 30.5,18.0001 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000'
     fill-rule='evenodd' />
  <path
     d='m 43.5,18.0001 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000'
     fill-rule='evenodd' />
  <path
     d='m 56.5,18.0001 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000'
     fill-rule='evenodd' />
  <path
     d='m 11.5,18.0001 c 0,-0.8285 1.343,-1.5 3,-1.5 1.657,0 3,0.6715 3,1.5 0,0.8284 -1.343,1.5 -3,1.5 -1.657,0 -3,-0.6716 -3,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff'
     fill-rule='evenodd' />
  <path
     d='m 24.5,18.0001 c 0,-0.8285 1.343,-1.5 3,-1.5 1.657,0 3,0.6715 3,1.5 0,0.8284 -1.343,1.5 -3,1.5 -1.657,0 -3,-0.6716 -3,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff'
     fill-rule='evenodd' />
  <path
     d='m 37.5,18.0001 c 0,-0.8285 1.343,-1.5 3,-1.5 1.657,0 3,0.6715 3,1.5 0,0.8284 -1.343,1.5 -3,1.5 -1.657,0 -3,-0.6716 -3,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff'
     fill-rule='evenodd' />
  <path
     d='m 50.5,18.0001 c 0,-0.8285 1.343,-1.5 3,-1.5 1.657,0 3,0.6715 3,1.5 0,0.8284 -1.343,1.5 -3,1.5 -1.657,0 -3,-0.6716 -3,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff'
     fill-rule='evenodd' />
  <path
     d='m 11.5,17.5001 v -17 l -7,17 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000'
     fill-rule='evenodd' />
  <rect
     x='17.5'
     y='0.50009918'
     width='7'
     height='17'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000' />
  <rect
     x='30.5'
     y='0.50009918'
     width='7'
     height='17'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000' />
  <rect
     x='43.5'
     y='0.50009918'
     width='7'
     height='17'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000' />
  <path
     d='m 56.5,17.5001 v -17 l 7,17 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000'
     fill-rule='evenodd' />
  <rect
     x='11.5'
     y='0.50009918'
     width='6'
     height='17'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff' />
  <rect
     x='24.5'
     y='0.50009918'
     width='6'
     height='17'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff' />
  <rect
     x='37.5'
     y='0.50009918'
     width='6'
     height='17'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff' />
  <rect
     x='50.5'
     y='0.50009918'
     width='6'
     height='17'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff' />
  <rect
     x='7.5'
     y='45.5'
     width='54'
     height='2'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#fdfac7' />
</svg>
  <text x='303' y='24.3' fill='black' font-family='Roboto,sans-serif' font-size='14.399999999999999' text-anchor='middle'>Merchant</text>
<svg x='403' y='32.0' width='40' height='40.0' viewBox='0 0 1000 1000' xmlns='http://www.w3.org/2000/svg'>
  <title>PSP Symbol</title>
  <!-- Anders Rundgren 2021 -->
  <defs>
    <radialGradient cx='0.5' cy='0.5' id='bigGearGid' r='0.5' spreadMethod='pad'>
      <stop offset='0.0' stop-color='white'/>
      <stop offset='0.8' stop-color='#c4eb4e'/>
    </radialGradient>
    <radialGradient cx='0.5' cy='0.5' id='smallGearGid' r='0.5' spreadMethod='pad'>
      <stop offset='0.3' stop-color='white'/>
      <stop offset='1.0' stop-color='#eccb1e'/>
    </radialGradient>
    <radialGradient cx='0.5' cy='0.5' id='shaftGid' r='0.5' spreadMethod='pad'>
      <stop offset='0.5' stop-color='white'/>
      <stop offset='1.0' stop-color='#8080ff'/>
    </radialGradient>
  </defs>
  <rect x='7.5' y='7.5' width='985' height='985' rx='70' fill='white' stroke='grey' stroke-width='15'/>
  <path stroke='#009a00' stroke-width='20' fill='url(#bigGearGid)' d='M399.9,799.7 456.2,902.6 479,896.5 476.3,779.3 493.5,769.3 593.6,830.3 610.3,813.6 549.3,713.5 559.3,696.3 676.5,699 682.6,676.2 579.7,619.9 579.7,600.1 682.6,543.8 676.5,521 559.3,523.7 549.3,506.5 610.3,406.4 593.6,389.7 493.5,450.7 476.3,440.7 479,323.5 456.2,317.4 399.9,420.3 380.1,420.3 323.8,317.4 301,323.5 303.7,440.7 286.5,450.7 186.4,389.7 169.7,406.4 230.7,506.5 220.7,523.7 103.5,521 97.4,543.8 200.3,600.1 200.3,619.9 97.4,676.2 103.5,699 220.7,696.3 230.7,713.5 169.7,813.6 186.4,830.3 286.5,769.3 303.7,779.3 301,896.5 323.8,902.6 380.1,799.7 z'/>
  <circle stroke='grey' stroke-width='15' fill='url(#shaftGid)' r='80' cx='390' cy='610'/>
  <path stroke='#f27b2b' stroke-width='20' fill='url(#smallGearGid)' d='M656.4,357.2 661.5,471.3 692.2,478.1 745,376.8 755,373.7 856.4,426.3 877.6,403.1 816.4,306.7 818.6,296.5 914.9,235 905.4,205.1 791.3,209.9 783.6,202.8 778.5,88.7 747.8,81.9 695,183.2 685,186.3 583.6,133.7 562.4,156.9 623.6,253.3 621.4,263.5 525.1,325 534.6,354.9 648.7,350.1 z'/>
  <circle stroke='grey' stroke-width='15' fill='url(#shaftGid)' r='50' cx='720' cy='280'/>
</svg>  <text x='423' y='24.3' fill='black' font-family='Roboto,sans-serif' font-size='14.399999999999999' text-anchor='middle'>PSP</text>
<svg x='512.4444444444445' y='32.0' width='61.111111111111114' height='40.0' viewBox='0 0 110 72' xmlns='http://www.w3.org/2000/svg'>
  <title>Issuer Symbol</title>
  <!-- Anders Rundgren 2021-->
  <defs>
    <linearGradient id='bankPillar' x1='0' x2='1'>
      <stop offset='0' stop-color='#606060'/>
      <stop offset='0.37' stop-color='#fdfff2'/>
      <stop offset='0.63' stop-color='#fdfff2'/>
      <stop offset='1' stop-color='#606060'/>
    </linearGradient>
    <filter height='200%' id='bankShaddow' width='200%' x='-50%' y='-50%'>
      <feGaussianBlur stdDeviation='2'/>
    </filter>
    <linearGradient id='bankFront' x1='0.5' x2='0.5' y1='0' y2='1'>
   <stop offset='0' stop-color='#eaeac5'/>
   <stop offset='0.4' stop-color='#f7f7f7'/>
   <stop offset='0.6' stop-color='#f7f7f7'/>
   <stop offset='1' stop-color='#eaeac5'/>
    </linearGradient>
    <linearGradient id='bankRoof' x1='0' x2='1' y1='0' y2='1'>
   <stop offset='0' stop-color='#f5f7e8'/>
   <stop offset='1' stop-color='#dceace'/>
    </linearGradient>
  </defs>
  <rect x='11' y='17' width='88' height='50' fill='white'/>
  <g fill='#b0b0b0' filter='url(#bankShaddow)'>
    <path d='m19.5,17.5l21.67,0l0,11l-10.67,0l0,35.5l-11,0'/>
    <path d='m41,17.5l21.67,0l0,11l-10.67,0l0,35.5l-11,0'/>
    <path d='m62.5,17.5l21.67,0l0,11l-10.67,0l0,35.5l-11,0'/>
    <path d='m 84,17.5 h 17 v 11 H 95 V 64 H 84'/>
  </g>
  <rect fill='url(#bankPillar)' height='37.5' width='11' x='17' y='26'/>
  <rect fill='url(#bankPillar)' height='37.5' width='11' x='38.66' y='26'/>
  <rect fill='url(#bankPillar)' height='37.5' width='11' x='60.33' y='26'/>
  <rect fill='url(#bankPillar)' height='37.5' width='11' x='82' y='26'/>
  <path d='m10.3,16 l44.70,-15 l44.70,15' fill='url(#bankRoof)' stroke='grey' stroke-width='1' stroke-linecap='round'/>
  <g stroke-width='0.7' stroke='grey'>
  <rect fill='url(#bankFront)' height='10' width='90' x='10' y='16'/>
  <rect fill='url(#bankFront)' height='4' width='100' x='5' y='67.5'/>
  <rect fill='url(#bankFront)' height='4' width='90' x='10' y='63.5'/>
  </g>
  <text x='55' y='23.9' font-size='8' font-weight='bold' font-family='Roboto,sans-serif' text-anchor='middle' fill='#707070'>
B&#xa0;&#xa0;A&#xa0;&#xa0;N&#xa0;&#xa0;K
</text>
</svg>
  <text x='543' y='24.3' fill='black' font-family='Roboto,sans-serif' font-size='14.399999999999999' text-anchor='middle'>Issuer</text>
  <line x1='302.4' y1='115' x2='191.1' y2='115' stroke-width='0.8' stroke='#cc1010' marker-end='url(#arrowHead)'/>
  <text x='243' y='109.7' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>PaymentRequest</text>
  <a href='#seq-1'>
  <rect x='296' y='108' width='14' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='303' y='119.3' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>1</text>
  </a>
  <rect x='141.75' y='133.75' width='86' height='50' fill='black' opacity='0.4' filter='url(#dropShaddow)'/>
  <rect x='139.75' y='131.75' width='86' height='50' fill='white' stroke-width='0.5' stroke='black'/>
  <rect x='139.75' y='131.75' width='86' height='5' fill='#deeafc' stroke-width='0.5' stroke='black'/>
  <text x='183' y='161.3' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>Payment UI</text>
  <a href='#seq-2'>
  <rect x='132.75' y='127.25' width='14' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='139.75' y='138.55' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>2</text>
  </a>
  <line x1='63.6' y1='207' x2='174.9' y2='207' stroke-width='0.8' stroke='#cc1010' marker-end='url(#arrowHead)' stroke-dasharray='4'/>
  <text x='123' y='201.70000000000002' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>Authorization</text>
  <a href='#seq-3'>
  <rect x='56' y='200' width='14' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='63' y='211.3' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>3</text>
  </a>
  <path fill='black' opacity='0.4' d='M146,225.75 l86,0 l-8,22 l-86,0Z' filter='url(#dropShaddow)'/>
  <path fill='#faf2dd' stroke='#404040' stroke-width='0.5' d='M144,223.75 l86,0 l-8,22 l-86,0Z'/>
  <text x='185.8' y='239.05' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>Processing</text>
  <a href='#seq-4'>
  <rect x='132.75' y='227.75' width='14' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='139.75' y='239.05' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>4</text>
  </a>
  <line x1='183.6' y1='290' x2='294.9' y2='290' stroke-width='0.8' stroke='#cc1010' marker-end='url(#arrowHead)'/>
  <text x='243' y='284.7' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>FWP Assertion</text>
  <a href='#seq-5'>
  <rect x='176' y='283' width='14' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='183' y='294.3' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>5</text>
  </a>
  <path fill='black' opacity='0.4' d='M266,308.75 l86,0 l-8,22 l-86,0Z' filter='url(#dropShaddow)'/>
  <path fill='#faf2dd' stroke='#404040' stroke-width='0.5' d='M264,306.75 l86,0 l-8,22 l-86,0Z'/>
  <text x='305.8' y='322.05' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>Processing</text>
  <a href='#seq-6'>
  <rect x='252.75' y='310.75' width='14' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='259.75' y='322.05' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>6</text>
  </a>
  <line x1='303.6' y1='354' x2='414.9' y2='354' stroke-width='0.8' stroke='#cc1010' marker-end='url(#arrowHead)'/>
  <text x='363' y='348.7' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>PSPRequest</text>
  <a href='#seq-7'>
  <rect x='296' y='347' width='14' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='303' y='358.3' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>7</text>
  </a>
  <path fill='black' opacity='0.4' d='M386,372.75 l86,0 l-8,22 l-86,0Z' filter='url(#dropShaddow)'/>
  <path fill='#faf2dd' stroke='#404040' stroke-width='0.5' d='M384,370.75 l86,0 l-8,22 l-86,0Z'/>
  <text x='425.8' y='386.05' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>Processing</text>
  <a href='#seq-8'>
  <rect x='372.75' y='374.75' width='14' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='379.75' y='386.05' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>8</text>
  </a>
  <line x1='423.6' y1='418' x2='534.9' y2='418' stroke-width='0.8' stroke='#cc1010' marker-end='url(#arrowHead)'/>
  <text x='483' y='412.7' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>IssuerRequest</text>
  <a href='#seq-9'>
  <rect x='416' y='411' width='14' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='423' y='422.3' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>9</text>
  </a>
  <path fill='black' opacity='0.4' d='M506,436.75 l86,0 l-8,22 l-86,0Z' filter='url(#dropShaddow)'/>
  <path fill='#faf2dd' stroke='#404040' stroke-width='0.5' d='M504,434.75 l86,0 l-8,22 l-86,0Z'/>
  <text x='545.8' y='450.05' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>Processing</text>
  <a href='#seq-10'>
  <rect x='490.65' y='438.75' width='18.2' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='498.95' y='450.05' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>10</text>
  </a>
  <rect x='38' y='87' width='290' height='175' rx='5' fill='none' stroke-width='0.5' stroke='black' stroke-dasharray='1'/>
</svg>
    </div>
    <div>
      Note that the <i>normative</i> part of this specification only covers the
      steps within the dotted rectangle. That is, how FWP implements
      the <a href="https://www.w3.org/TR/payment-request/"
             title="PaymentRequest">PaymentRequest<img src="images/xtl.svg" alt="link"></a>
      interface.
    </div>
     <div class="para">
       For brevity return (status) messages are not shown in the diagram.
     </div>
    <div class="step"><div id="seq-1" class="numbox">1</div>Initiate PaymentRequest</div>
    <div>
      At this point the <b class="actor">User</b> is assumed having clicked on
      an FWP compliant icon like
    </div>
    <img src="images/fwp-pay.svg" alt="fwp pay" title="FWP logo in a payment network selection page" style="width: 10em; margin: 0.7em 0 0.4em 0; box-shadow: 0.2em 0.2em 0.2em #d0d0d0">
    <div>
      causing a <b class="actor">Merchant</b> Web page to invoke
      a custom doPaymentRequest() method, like in the following sample:
    </div> 
     <div style='overflow-x:auto;padding-right:0.2em'>
      <div class="staticbox" style="min-width:45em">
        //&nbsp;FWP&nbsp;sample&nbsp;code<br><br>const&nbsp;methodData&nbsp;=&nbsp;[{<br>&nbsp;&nbsp;supportedMethods:&nbsp;&quot;fido-web-pay/v1&quot;,<br>&nbsp;&nbsp;data:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;payeeName:&nbsp;&quot;Space&nbsp;Shop&quot;,&nbsp;&nbsp;//&nbsp;Shown&nbsp;in&nbsp;the&nbsp;UI<br>&nbsp;&nbsp;&nbsp;&nbsp;networks:&nbsp;[{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id:&nbsp;&quot;https://mastercard.com/fwp&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;},{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id:&nbsp;&quot;https://visa.com/fwp&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;},{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id:&nbsp;&quot;https://banknet2.org&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;networkOptions:&nbsp;&quot;additional&nbsp;stuff...&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;}]<br>&nbsp;&nbsp;}<br>}];<br><br>const&nbsp;request&nbsp;=&nbsp;new&nbsp;PaymentRequest(methodData,&nbsp;{<br>&nbsp;&nbsp;id:&nbsp;&quot;7040566321&quot;,&nbsp;&nbsp;&nbsp;//&nbsp;Mandatory&nbsp;for&nbsp;FWP<br>&nbsp;&nbsp;total:&nbsp;{label:&nbsp;null,&nbsp;amount:&nbsp;{currency:&nbsp;&quot;EUR&quot;,&nbsp;value:&nbsp;&quot;435.00&quot;}}<br>});<br><br>async&nbsp;function&nbsp;doPaymentRequest()&nbsp;{<br>&nbsp;&nbsp;const&nbsp;response&nbsp;=&nbsp;await&nbsp;request.show();<br>&nbsp;&nbsp;await&nbsp;response.complete(&quot;success&quot;);<br>&nbsp;&nbsp;return&nbsp;response.details;<br>}<br>
      </div>
    </div>
    <div>
      When the <code>PaymentRequest</code> constructor is invoked, the <span class="actor">Browser</span>
      (FWP implementation) MUST perform the following checks:
    </div>
    <ul>
      <li>
        There is an accompanying <code>data</code> attribute holding a
        <i>JSON-serializable</i> JavaScript <kbd>Object</kbd>.
      </li>
      <li>
        The <code>data</code> object contains a <code>payeeName</code>
        attribute holding a <i>non-empty</i> JavaScript <kbd>String</kbd> argument.
      </li>
      <li>
        The <code>data</code> object contains a <code>networks</code>
        attribute holding a JavaScript <kbd>Array</kbd> argument.
      </li>
      <li>
        The <code>networks</code> array holds a <i>non-empty</i> list of
        JavaScript <kbd>Object</kbd>s.
      </li>
      <li>
        That each object in the <code>networks</code> array contains a <code>id</code>
        attribute holding a <i>non-empty</i> JavaScript <kbd>String</kbd> argument.
      </li>
      <li id="jsonlimit">
        That none of the objects in the <code>networks</code> array contain other
        attributes, with the exception of an <i>optional</i> <code>networkOptions</code>
        attribute holding an arbitrary JavaScript/JSON-compatible argument, where the
        <kbd>Number</kbd> type
        is limited to <i>integers</i> in the range of -2^53 to +2^53.
      </li>
      <li>
        There is only <i>one</i> <code>PaymentItem</code> and it has a
        <code>label</code> attribute with the argument <kbd>null</kbd>.
      </li>
      <li>
        There is a <i>non-empty</i> <code>id</code> argument included in the
        <code>details</code> parameter to the <code>PaymentRequest</code> constructor.
      </li>
    </ul>
    <div class="para">Any deviations MUST throw an exception.</div>
    <div class="para">
      Note that the <code>id</code> properties in the <code>networks</code>
      array denote the actual payment networks, corresponding to the <code>paymentNetworkId</code>
      attribute in <a href="#credentialdatabase">FWP credentials</a>.
    </div>
    <div class="para">
      Note that the <code>PaymentRequest.canMakePayment()</code> method MUST return <kbd>true</kbd>
      if the <span class="actor">User</span> have one or more FWP credentials,
      regardless if they match the associated <code>PaymentRequest</code> list or not;
      else it MUST return <kbd>false</kbd>.
    </div>
    <div class="step"><div id="seq-2" class="numbox">2</div>Show Payment Authorization UI</div>
    <div style="margin-bottom:0.8em">
      After successful invocation of the <code>PaymentRequest.show()</code>
      method, the <b class="actor">Browser</b> responds with
      a payment authorization UI like the following:
    </div>
    <div style="overflow-x:auto;padding-bottom:0.5em">
      <img style="display:block;width:22em;box-shadow:2pt 2pt 3pt #808080;border-width:1pt;border-style:solid;border-color:darkgrey" alt="Payment UI" title="Payment UI" src="images/ui.svg">
    </div>
    <div>Non-normative UI in &quot;dark mode&quot;.</div>
    <div class="para">
      If the <b class="actor">User</b> has no matching payment credentials,
      the <b class="actor">Browser</b> MUST indicate that and give the <b class="actor">User</b>
      an option to return to the <b class="actor">Merchant</b> &quot;Checkout&quot; page.
    </div>
    <div class="para">
      If the <b class="actor">User</b> has multiple matching payment credentials,
      the <b class="actor">Browser</b> MUST provide a way to select a specific credential.
      In the sample UI shown above, the <b class="actor">User</b>
      can swipe credentials to the left and right, while arrow symbols are used to show if there
      are more credentials available.  That is, if there is no left arrow, the credential selector is
      at the left end point.
    </div>
    <div id="externaltoken" class="para">
      If a selected credential is associated with an <i>external</i> token which is currently not
      available, the <b class="actor">User</b> should be asked to insert it.
    </div>
    <div class="step"><div id="seq-3" class="numbox">3</div>Perform User Authorization</div>
    <div>
      At this point the <b class="actor">User</b>
      <i>authorizes</i> the request with a fingerprint, PIN, or similar.
      A successful user authorization causes the next step to be performed.
    </div>
    <div class="step"><div id="seq-4" class="numbox">4</div>Create FWP Assertion</div>
    <div>
      At this point the <b class="actor">Browser</b>
      creates an FWP assertion which requires the following substeps to be performed:
    </div>
    <div id="seq-4.1" class="step">4.1 Extract PaymentRequest Core Data (PRCD)</div>
    <div class="para">
      Create a <a href="#cbor">CBOR</a> representation of the core payment request data supplied
      by the <b class="actor">Merchant</b>.  For the sample code this should
      result in the following object:
    </div>
    <div class="staticbox">
      {<br>&nbsp;&nbsp;1:&nbsp;&quot;Space&nbsp;Shop&quot;,<br>&nbsp;&nbsp;2:&nbsp;&quot;7040566321&quot;,<br>&nbsp;&nbsp;3:&nbsp;&quot;435.00&quot;<br>&nbsp;&nbsp;4:&nbsp;&quot;EUR&quot;<br>}<br>
    </div>
    <div>Definition:</div>
    <div style='overflow-x:auto;padding-right:0.2em'>
      <table class="tftable">
      <tr><th>Name</th><th>Label</th><th>Type</th><th style="min-width:25em">Description</th></tr>
      <tr>
        <td><code>payeeName</code></td>
        <td style='text-align:center'><kbd>1</kbd></td>
        <td><kbd>tstr</kbd></td>
        <td>
          <b class="actor">Merchant</b> common name.
        </td>
      </tr>
      <tr>
        <td><code>requestId</code></td>
        <td style='text-align:center'><kbd>2</kbd></td>
        <td><kbd>tstr</kbd></td>
        <td>
          <b class="actor">Merchant</b> request Id. Copy of <code>details.id</code>.
        </td>
      </tr>
      <tr>
        <td><code>amount</code></td>
        <td style='text-align:center'><kbd>3</kbd></td>
        <td><kbd>tstr</kbd></td>
        <td>
          Amount of money requested by the <b class="actor">Merchant</b>.
        </td>
      </tr>
      <tr>
        <td><code>currency</code></td>
        <td style='text-align:center'><kbd>4</kbd></td>
        <td><kbd>tstr</kbd></td>
        <td>
          The type of currency requested by the <b class="actor">Merchant</b>.
        </td>
      </tr>
    </table>
</div>
    <div>
      This object is subsequently referred to as PaymentRequest Core Data (PRCD).
    </div>
    <div class="para">
      Note that throughout this specification, elements are referred to
      by their symbolic name rather than by their <a href="#cbor">CBOR</a> label.
    </div>

    <div id="seq-4.2" class="step">
      4.2 Create Authorization Data (AD)
    </div>
    <div class="para">
      Create a <a href="#cbor">CBOR</a> object representing the data to authorize.
      For the sample code this should result in the following object:
    </div>

    <div style='overflow-x:auto;padding-right:0.2em'>
      <div class="staticbox" style="min-width:50em">
        {<br>&nbsp;&nbsp;1:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;&quot;Space&nbsp;Shop&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;2:&nbsp;&quot;7040566321&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;3:&nbsp;&quot;435.00&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;4:&nbsp;&quot;EUR&quot;<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;2:&nbsp;&quot;spaceshop.com&quot;,<br>&nbsp;&nbsp;3:&nbsp;&quot;FR7630002111110020050014382&quot;,<br>&nbsp;&nbsp;4:&nbsp;&quot;https://banknet2.org&quot;,<br>&nbsp;&nbsp;5:&nbsp;&quot;0057162932&quot;,<br>&nbsp;&nbsp;6:&nbsp;&quot;additional&nbsp;stuff...&quot;,<br>&nbsp;&nbsp;7:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:&nbsp;&quot;Android&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4:&nbsp;&quot;12.0&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;2:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:&nbsp;&quot;Chrome&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4:&nbsp;&quot;108&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;8:&nbsp;&quot;2023-01-07T10:14:07+01:00&quot;,<br>&nbsp;&nbsp;-1:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;-7,<br>&nbsp;&nbsp;&nbsp;&nbsp;2:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;2,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-1:&nbsp;1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-2:&nbsp;h&#039;e812b1a6dcbc708f9ec43cc2921fa0a14e9d5eadcc6dc63471dd4b680c6236b5&#039;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-3:&nbsp;h&#039;9826dcbd4ce6e388f72edd9be413f2425a10f75b5fd83d95fa0cde53159a51d8&#039;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>}
      </div>
    </div>
    <div>Definition:</div>
    <div style='overflow-x:auto;padding-right:0.2em'>
      <table class="tftable">
        <tr><th>Name</th><th>Label</th><th>Type</th><th style="min-width:30em">Description</th></tr>
        <tr>
          <td><code>paymentRequest</code></td>
          <td style='text-align:center'><kbd>1</kbd></td>
          <td><kbd>map</kbd></td>
          <td>
            Copy of PaymentRequest Core Data (<a href="#seq-4.1">PRCD</a>).
          </td>
        </tr>
        <tr>
          <td><code>payeeHost</code></td>
          <td style='text-align:center'><kbd>2</kbd></td>
          <td><kbd>tstr</kbd></td>
          <td>
            Host name as interpreted by the <b class="actor">Browser</b>.
            Included for optional validation by the <b class="actor">Issuer</b>,
            aided by the <b class="actor">PSP</b>.
          </td>
        </tr>
        <tr>
          <td><code>accountId</code></td>
          <td style='text-align:center'><kbd>3</kbd></td>
          <td><kbd>tstr</kbd></td>
          <td>
            <b class="actor">User</b> account number associated
            with the selected <a href="#credentialdatabase">FWP credential</a>.
          </td>
        </tr>
        <tr>
          <td><code>paymentNetworkId</code></td>
          <td style='text-align:center'><kbd>4</kbd></td>
          <td><kbd>tstr</kbd></td>
          <td>
            Payment network associated with the selected <a href="#credentialdatabase">FWP credential</a>.
            Included for &quot;completeness&quot;.
          </td>
        </tr>
        <tr>
          <td><code>serialNumber</code></td>
          <td style='text-align:center'><kbd>5</kbd></td>
          <td><kbd>tstr</kbd></td>
          <td>
            Unique identifier associated with the selected <a href="#credentialdatabase">FWP credential</a>.
          </td>
        </tr>
        <tr>
          <td><code>networkOptions</code></td>
          <td style='text-align:center'><kbd>6</kbd></td>
          <td><i>&quot;Any&quot;</i></td>
          <td>
            <i>Optional</i>.  This attribute MUST be included if
            specified in the <code>PaymentRequest</code> constructor
            for the particular <code>paymentNetworkId</code>, otherwise it MUST NOT be defined.
            <div style="margin-top:0.4em">
              Note that possible <code>networkOptions</code> is specified by the calling
              <span class="actor">Merchant</span> as JavaScript, but MUST subsequently
              be converted to CBOR when included in this object.  Due to a
              <a href="#jsonlimit">mandated restriction</a>
              on the JavaScript <kbd>Number</kbd> type, this conversion is
              straightforward:
              <ul>
                <li>
                  <kbd>Number</kbd> is converted to <kbd>int</kbd>.
                </li>
                <li>
                  <kbd>String</kbd> is converted to <kbd>tstr</kbd>.
                </li>
                <li><kbd>Object</kbd> is converted to <kbd>map</kbd>.</li>
                <li><kbd>Array</kbd> is converted to <kbd>array</kbd>.</li>
                <li>
                  <kbd>null</kbd>, <kbd>true</kbd>, and <kbd>false</kbd>
                  are converted to their respective CBOR counterpart.
                </li>
              </ul>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>platformData</code></td>
          <td style='text-align:center'><kbd>7</kbd></td>
          <td><kbd>map</kbd></td>
          <td>
            Up-to-date information about the core <i>software</i> components.
            Included for <i>security and logging</i> purposes.
            <div style="margin-top:0.4em">
              The outer CBOR map holds two sub&nbsp;maps with
              <kbd>int</kbd> label <kbd>1</kbd> for the operating system,
              and <kbd>int</kbd> label <kbd>2</kbd> for the "user-agent" (browser).
              Each sub&nbsp;map holds two <kbd>tstr</kbd> arguments,
              <code>name</code> with <kbd>int</kbd> label <kbd>3</kbd>
              and <code>version</code> with <kbd>int</kbd> label <kbd>4</kbd>
              respectively.
            </div>
            <div style="margin-top:0.4em">
              Note that <i>hardware</i> (device) data is assumed to be established during credential
              <a href="#enrollment">enrollment</a>.
            </div>
          </td>
        </tr>
        <tr>
          <td><code>timeStamp</code></td>
          <td style='text-align:center'><kbd>8</kbd></td>
          <td><kbd>tstr</kbd></td>
          <td>
            ISO (<a href="https://tools.ietf.org/html/rfc3339"
                    title="RFC3399">RFC3399<img src="images/xtl.svg" alt="link"></a>)
            time stamp generated by the FWP implementation.
            If the local time zone is known, it SHOULD be included,
            else the UTC notation (&quot;Z&quot;) MUST be used.
          </td>
        </tr>
        <tr>
          <td><code>signature</code></td>
          <td style='text-align:center'><kbd>-1</kbd></td>
          <td><kbd>map</kbd></td>
          <td>
            <b class="actor">User</b> authorization signature.
            See <a href="crypto.html#4.1"
                   title="FIDO Web Pay - Crypto">FIDO Web Pay - Crypto<img src="images/xtl.svg" alt="link"></a>
            for details.

          </td>
        </tr>
      </table>
    </div>
    <div>
      This object is subsequently referred to as Authorization Data (AD).
    </div>

    <div id="seq-4.3" class="step">4.3 Create Signed Authorization Data (SAD)</div>
    <div class="para">
      Now apply the FIDO signature key (identified by <a href="#credentialdatabase">credentialId</a>
      and <a href="#credentialdatabase">rpId</a>),
      associated with the selected FWP credential to sign AD using the
      scheme described in
      <a href="crypto.html#4.2"
         title="FIDO Web Pay - Crypto">FIDO Web Pay - Crypto<img src="images/xtl.svg" alt="link"></a>.
      For the sample code this should result in the following object:
    </div>
    <div style='overflow-x:auto;padding-right:0.2em'>
      <div class="staticbox" style="min-width:60em">
        {<br>&nbsp;&nbsp;1:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;&quot;Space&nbsp;Shop&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;2:&nbsp;&quot;7040566321&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;3:&nbsp;&quot;435.00&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;4:&nbsp;&quot;EUR&quot;<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;2:&nbsp;&quot;spaceshop.com&quot;,<br>&nbsp;&nbsp;3:&nbsp;&quot;FR7630002111110020050014382&quot;,<br>&nbsp;&nbsp;4:&nbsp;&quot;https://banknet2.org&quot;,<br>&nbsp;&nbsp;5:&nbsp;&quot;0057162932&quot;,<br>&nbsp;&nbsp;6:&nbsp;&quot;additional&nbsp;stuff...&quot;,<br>&nbsp;&nbsp;7:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:&nbsp;&quot;Android&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4:&nbsp;&quot;12.0&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;2:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:&nbsp;&quot;Chrome&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4:&nbsp;&quot;108&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;8:&nbsp;&quot;2023-01-07T10:14:07+01:00&quot;,<br>&nbsp;&nbsp;-1:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;-7,<br>&nbsp;&nbsp;&nbsp;&nbsp;2:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;2,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-1:&nbsp;1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-2:&nbsp;h&#039;e812b1a6dcbc708f9ec43cc2921fa0a14e9d5eadcc6dc63471dd4b680c6236b5&#039;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-3:&nbsp;h&#039;9826dcbd4ce6e388f72edd9be413f2425a10f75b5fd83d95fa0cde53159a51d8&#039;<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;3:&nbsp;h&#039;412e175a0f0bdc06dabf0b1db79b97541c08dbacee7e31c97a553588ee922ea70500000017&#039;,<br>&nbsp;&nbsp;&nbsp;&nbsp;4:&nbsp;h&#039;3045022100c0784c01d7aea61e158910c3b05ff409105ff0f5f673e19ba3b84756cc2c23f1022035095fd2528c6af9f68a23ec99643359d543faec92c4dfa248e642ca2b5cb8f3&#039;<br>&nbsp;&nbsp;}<br>}
      </div>
    </div>
    <div>
      This operation updates the <code>signature</code> (<kbd>-1</kbd>) element of AD.
    </div>
    <div class="para">The resulting object is subsequently referred to as Signed Authorization Data (SAD).</div>
    <div class="comment box">
      There is no FIDO authentication server involved in this step since FWP
      builds on the same &quot;Card Present&quot; authorization concept as EMV.
    </div>

    <div id="seq-4.4" class="step">4.4 Create Encrypted Signed Authorization Data (ESAD)</div>
    <div class="para">
      For privacy and security reasons, Signed Authorization Data (SAD) objects
      MUST be encrypted by a public key provided by the <b class="actor">Issuer</b>
      through the <a href="#credentialdatabase">encryptionKey</a>
      attribute of the selected FWP credential.
    </div>
     <div class="para">
      This specification mandates the encryption scheme described in
       <a href="crypto.html#5"
          title="FIDO Web Pay - Crypto">FIDO Web Pay - Crypto<img src="images/xtl.svg" alt="link"></a>.
    </div>
    <div class="para">
      Note the <a href="https://www.ietf.org/archive/id/draft-rundgren-cotx-03.html">
        COTX<img src="images/xtl.svg" alt="link">
      </a> tag which is used to identify the FWP assertion object in its entirety.
    </div>
    <div class="para">
      Note that the public key MUST be <i>shared</i> with
      other clients of the <b class="actor">Issuer</b>, otherwise it will work
      as a static identifier to the specific <b class="actor">User</b>!
    </div>
    <div class="para">
      Encryption sample object:
    </div>
    <div style='overflow-x:auto;padding-right:0.2em'>
      <div class="staticbox" style="min-width:60em">
        1010([&quot;https://fido-web-pay.github.io/ns/p1&quot;,&nbsp;{<br>&nbsp;&nbsp;1:&nbsp;3,<br>&nbsp;&nbsp;2:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;-31,<br>&nbsp;&nbsp;&nbsp;&nbsp;3:&nbsp;&quot;x25519:2022:1&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;7:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-1:&nbsp;4,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-2:&nbsp;h&#039;91d00183af3e92b443676e3faf8b4b2130bfe6ba98538d27eba49dc1ae386810&#039;<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;10:&nbsp;h&#039;06555f65ecf806b6b819216ce9bc51ed1b6800915685a2889f6ef5254d2ca955a49135b25a08c6e9&#039;<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;8:&nbsp;h&#039;bbb6e2671e25c6346cebd4877d0b635f&#039;,<br>&nbsp;&nbsp;9:&nbsp;h&#039;ebe57e33a6bb79e1917dc0be&#039;,<br>&nbsp;&nbsp;10:&nbsp;h&#039;2c7600f3aa3749829df50347233afb81e4a7674a50470968466050195dabd99f377854885e4838181a844993665726f77a3ff16402e5b45e8479cc8045076483dac05cfcca7a89ae73fe39b0e0ac38e632cb9ee80dc89b5ca5575ddf0c7640c0d674f684f3da4db4ec89dfcdbe345d504f5609f6cfcf27ca112231ee18d8088fe05a9c8d94cf3e7eabe3fcc7f4dd0e81b24a1602731734161c8bae87e147a6e802b694029b92bd3dc07ed34a31753b7c8781e42fa57a43b6c8f10d525007f88d3f88d0e5ca50148d9945fcd355c1029a310cb61fa629c15fa1ea4b3e5b7c69df629ec421167f9ad371fcba77910a4dd4d34081382367751c29ed18781797886e6f91f2377a30bdf6264435781177b28be0c7a53ca97d5d66083fe943bf154b014eb9fd5372fd7be1b11f5142045b6b58566de9975a884f5fa7cdce32ec9293b704d072a17d535dbdc00316d6764b5058b9593cb2bdb2a28f53cee950bb15a400e832977f1315b666ef40664c15401697cf27d4abd4222ecabda6114684e89f1469d79f8571835676df389019&#039;<br>}])
      </div>
    </div>
    <div>
      This object is subsequently referred to as Encrypted Signed Authorization Data (ESAD).
    </div>
    <div id="domainconstraints" class="para box comment">
      Due to the end-to-end encryption scheme, the domain
      constraints associated with Web Authentication
      assertions do not apply.
    </div>

    <div id="seq-4.5" class="step">4.5 Assemble FWP Assertion</div>
    <div class="para">
      Create a JSON-serializable JavaScript object representing an <span class="msg">FWP Assertion</span>.
      For the sample code this should result in the following object:
    </div>
    <div style='overflow-x:auto;padding-right:0.2em'>
      <div class="staticbox" style="min-width:60em">
        {<br>&nbsp;&nbsp;&quot;paymentNetworkId&quot;:&nbsp;&quot;https://banknet2.org&quot;,<br>&nbsp;&nbsp;&quot;issuerId&quot;:&nbsp;&quot;https://mybank.fr/payment&quot;,<br>&nbsp;&nbsp;&quot;userAuthorization&quot;:&nbsp;&quot;2QPygngkaHR0cHM6Ly9maWRvLXdlYi1wYXkuZ2l0aHViLmlvL25zL3AxpQEDAqQBOB4DbXgyNTUxOToyMDIyOjEHowEBIAQhWCCR0AGDrz6StENnbj-vi0shML_muphTjSfrpJ3BrjhoEApYKAZVX2Xs-Aa2uBkhbOm8Ue0baACRVoWiiJ9u9SVNLKlVpJE1sloIxukIULu24mceJcY0bOvUh30LY18JTOvlfjOmu3nhkX3AvgpZAYwsdgDzqjdJgp31A0cjOvuB5KdnSlBHCWhGYFAZXavZnzd4VIheSDgYGoRJk2ZXJvd6P_FkAuW0XoR5zIBFB2SD2sBc_Mp6ia5z_jmw4Kw45jLLnugNyJtcpVdd3wx2QMDWdPaE89pNtOyJ382-NF1QT1YJ9s_PJ8oRIjHuGNgIj-BanI2Uzz5-q-P8x_TdDoGyShYCcxc0FhyLrofhR6boAraUApuSvT3AftNKMXU7fIeB5C-lekO2yPENUlAH-I0_iNDlylAUjZlF_NNVwQKaMQy2H6YpwV-h6ks-W3xp32KexCEWf5rTcfy6d5EKTdTTQIE4I2d1HCntGHgXl4hub5HyN3owvfYmRDV4EXeyi-DHpTypfV1mCD_pQ78VSwFOuf1Tcv174bEfUUIEW2tYVm3pl1qIT1-nzc4y7JKTtwTQcqF9U129wAMW1nZLUFi5WTyyvbKij1PO6VC7FaQA6DKXfxMVtmbvQGZMFUAWl88n1KvUIi7KvaYRRoTonxRp15-FcYNWdt84kBk&quot;<br>}<br>
      </div>
    </div>
    <div>Definition:</div>
  <div style='overflow-x:auto;padding-right:0.2em'>
    <table class="tftable">
      <tr><th>Name</th><th>Type</th><th style="min-width:30em">Description</th></tr>
      <tr>
        <td><code>paymentNetworkId</code></td>
        <td><kbd>String</kbd></td>
        <td>
          Payment network associated with the selected <a href="#credentialdatabase">FWP credential</a>.
        </td>
      </tr>
      <tr>
        <td><code>issuerId</code></td>
        <td><kbd>String</kbd></td>
        <td>
          Issuer identifier associated with the selected <a href="#credentialdatabase">FWP credential</a>.
        </td>
      </tr>
      <tr>
        <td><code>userAuthorization</code></td>
        <td><kbd>String</kbd></td>
        <td>
          Encrypted Signed Authorization Data (ESAD) supplied in a Base64Url string
          (in subsequent examples shown as a placeholder only).
        </td>
      </tr>
    </table>
</div>
      <div>
        The <span class="msg">FWP Assertion</span> is made available
        to the <code>PaymentRequest</code> invocation code via the
        <code>PaymentResponse.details</code> attribute.
      </div>
      <div id="servicediscovery" class="comment box">
        An alternative to using <code>issuerId</code> attributes for service
        end-points, is populating <code>issuerId</code> attributes with <i>Service Discovery URLs</i>,
        which in turn provide the actual service end-points (as well as other information
        that may be required <i>before</i> service invocation).
      </div>
      <div class="step"><div id="seq-5" class="numbox">5</div>Return FWP Assertion</div>
      <div>
        At this point the checkout Web code would normally
        return the completed <span class="msg">FWP Assertion</span> to the
        <b class="actor">Merchant</b> server through a FORM&nbsp;POST
        or <code>fetch()</code> operation.
      </div>
      <div class="step"><div id="seq-6" class="numbox">6</div>Process FWP Assertion and Create PSPRequest Object</div>

      <div>
        After receiving the <span class="msg">FWP Assertion</span>,
        the <b class="actor">Merchant</b> would usually call a
        <b class="actor">PSP</b> with a specifically crafted object.
        The exact definition is likely to be specific for each <b class="actor">PSP</b> network
        and is therefore out of scope for this specification.
        The following <i>sample</i> outlines such an object:
      </div>
    <div style='overflow-x:auto;padding-right:0.2em'>
      <div class="staticbox" style="min-width:35em">
        {<br>&nbsp;&nbsp;&quot;paymentRequest&quot;:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&quot;payeeName&quot;:&nbsp;&quot;Space&nbsp;Shop&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&quot;requestId&quot;:&nbsp;&quot;7040566321&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&quot;amount&quot;:&nbsp;&quot;435.00&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&quot;currency&quot;:&nbsp;&quot;EUR&quot;<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;&quot;fwpAssertion&quot;:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&quot;paymentNetworkId&quot;:&nbsp;&quot;https://banknet2.org&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&quot;issuerId&quot;:&nbsp;&quot;https://mybank.fr/payment&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&quot;userAuthorization&quot;:&nbsp;&quot;2QPy&#x2022;&#x2022;&#x2022;4kBk&quot;<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;&quot;receiveAccount&quot;:&nbsp;&quot;DE89370400440532013000&quot;,<br>&nbsp;&nbsp;&quot;clientIpAddress&quot;:&nbsp;&quot;220.13.198.144&quot;,<br>&nbsp;&nbsp;&quot;timeStamp&quot;:&nbsp;&quot;2023-01-07T09:14:22Z&quot;<br>}<br>
      </div>
    </div>
      <div>Definition:</div>
    <div style='overflow-x:auto;padding-right:0.2em'>
      <table class="tftable">
        <tr><th>Name</th><th>Type</th><th style="min-width:30em">Description</th></tr>
        <tr>
          <td><code>paymentRequest</code></td>
          <td><kbd>Object</kbd></td>
          <td>
            Copy of <a href="#seq-4.1">PRCD</a>, <i>recreated</i> by the <b class="actor">Merchant</b>,
            but now in JSON notation using the names from the table showing the CBOR version.
          </td>
        </tr>
        <tr>
          <td><code>fwpAssertion</code></td>
          <td><kbd>Object</kbd></td>
          <td>
            Copy of the <a href="#seq-4.5">FWP Assertion</a>.
          </td>
        </tr>
        <tr>
          <td><code>receiveAccount</code></td>
          <td><kbd>String</kbd></td>
          <td>
            <b class="actor">Merchant</b> account to be credited.
          </td>
        </tr>
        <tr>
          <td><code>clientIpAddress</code></td>
          <td><kbd>String</kbd></td>
          <td>
            Request IP address (in V4 or V6 format) of the <b class="actor">User</b> device.
            Included for <i>security and logging</i> purposes.
          </td>
        </tr>
        <tr>
          <td><code>timeStamp</code></td>
          <td><kbd>String</kbd></td>
          <td>
            ISO time stamp generated by the <b class="actor">Merchant</b>.
          </td>
        </tr>
      </table>
    </div>
      <div class="step">
        <div id="seq-7" class="numbox">7</div>Send PSPRequest Object
      </div>
      <div>
        At this point the <b class="actor">Merchant</b> sends the completed <span class="msg">PSPRequest</span>
        object to the appropriate <b class="actor">PSP</b>.
      </div>
      <div class="para">
        Note that authentication of the <b class="actor">Merchant</b> is out of scope
        for this specification.
      </div>
      <div id="pspselection" class="comment box">
        Since FWP supports <i>multiple</i> and <i>independent</i> payment systems,
        a <b class="actor">Merchant</b> may use different <b class="actor">PSP</b>s
        depending on received <code>paymentNetworkId</code>.
      </div>
      <div class="step">
        <div id="seq-8" class="numbox">8</div>Process PSPRequest and Create IssuerRequest Object
      </div>
      <div>
        After successfully having authenticated the <b class="actor">Merchant</b> request,
        the <b class="actor">PSP</b> MUST perform a number of checks on the
        received object including:
      </div>
      <ul>
        <li>
          That <code>paymentRequest</code> is properly formatted and that
          the <code>payeeName</code> attribute
          matches the <b class="actor">Merchant</b> common name registered with the <b class="actor">PSP</b>.
        </li>
        <li>
          That the <code>fwpAssertion.paymentNetworkId</code> is supported.
        </li>
        <li>
          That the format of the <code>fwpAssertion.issuerId</code> matches 
          <code>fwpAssertion.paymentNetworkId</code>.
        </li>
        <li>
          That the <code>receiveAccount</code> matches a <b class="actor">Merchant</b> account
          registered with the <b class="actor">PSP</b>.
        </li>
        <li>
          That the <code>timeStamp</code> is within &quot;reasonable limits&quot;.
        </li>
        <li>
          That the rest of the expected parameters are available as well that there are no unknown attributes.
        </li>
      </ul>
      <div class="para">
        Any deviations MUST cause the request to be rejected.
        Fault handling is out of scope for this specification.
      </div>
      <div class="para">
        The next step is creating a suitable <span class="msg">IssuerRequest</span> object.
        The exact definition is likely to be specific for each payment network and
        is therefore out of scope for this specification.
        The following <i>sample</i> outlines such an object:
      </div>
    <div style='overflow-x:auto;padding-right:0.2em'>
      <div class="staticbox" style="min-width:35em">
        {<br>&nbsp;&nbsp;&quot;pspRequest&quot;:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&quot;paymentRequest&quot;:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;payeeName&quot;:&nbsp;&quot;Space&nbsp;Shop&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;requestId&quot;:&nbsp;&quot;7040566321&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;amount&quot;:&nbsp;&quot;435.00&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;currency&quot;:&nbsp;&quot;EUR&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&quot;fwpAssertion&quot;:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;paymentNetworkId&quot;:&nbsp;&quot;https://banknet2.org&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;issuerId&quot;:&nbsp;&quot;https://mybank.fr/payment&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;userAuthorization&quot;:&nbsp;&quot;2QPy&#x2022;&#x2022;&#x2022;4kBk&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&quot;receiveAccount&quot;:&nbsp;&quot;DE89370400440532013000&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&quot;clientIpAddress&quot;:&nbsp;&quot;220.13.198.144&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&quot;timeStamp&quot;:&nbsp;&quot;2023-01-07T09:14:23Z&quot;<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;&quot;payeeHost&quot;:&nbsp;&quot;spaceshop.com&quot;,<br>&nbsp;&nbsp;&quot;timeStamp&quot;:&nbsp;&quot;2023-01-07T09:14:23Z&quot;<br>}<br>
      </div>
    </div>

      <div>Definition:</div>
    <div style='overflow-x:auto;padding-right:0.2em'>
      <table class="tftable">
        <tr><th>Name</th><th>Type</th><th style="min-width:30em">Description</th></tr>
        <tr>
          <td><code>pspRequest</code></td>
          <td><kbd>Object</kbd></td>
          <td>
            Copy of the <a href="#seq-6">PSPRequest</a> object
            received from the <b class="actor">Merchant</b>.
          </td>
        </tr>
        <tr>
          <td><code>payeeHost</code></td>
          <td><kbd>String</kbd></td>
          <td>
            The <b class="actor">Merchant</b> host name registered by the <b class="actor">PSP</b>.
          </td>
        </tr>
        <tr>
          <td><code>timeStamp</code></td>
          <td><kbd>String</kbd></td>
          <td>
            ISO time stamp generated by the <b class="actor">PSP</b>.
          </td>
        </tr>
      </table>
</div>
    <div class="step">
      <div id="seq-9" class="numbox">9</div>Send IssuerRequest Object
    </div>
    <div>
      At this point the <b class="actor">PSP</b> sends the completed <span class="msg">IssuerRequest</span>
      object to the designated <b class="actor">Issuer</b>.
      Note that the method used for locating the proper <b class="actor">Issuer</b> depends on
      the <code>paymentNetworkId</code> and <code>issuerId</code> attributes.
      In the sample the <span class="msg">IssuerRequest</span> object
      would presumably be sent to <span class="msg">https://mybank.fr/payment</span>.
    </div>
    <div class="step">
      <div id="seq-10" class="numbox">10</div>Process IssuerRequest
    </div>
    <div>
      Before initiating a payment transaction the <b class="actor">Issuer</b>
      MUST decode and perform a number of steps to verify the
      correctness of the received <span class="msg">IssuerRequest</span> object.
      Any deviation MUST terminate the operation in progress and return an
      error message to the <b class="actor">PSP</b> in a not here specified manner.
    </div>
    <div class="para">
      Note that <code>pspRequest</code> is a <i>sample</i>.
      However, regardless of the actual implementation,
      the data referred to here MUST still be available.
    </div>
    <div id="seq-10.1" class="step">
      10.1 Core Validation
    </div>
    <ul>
      <li>
        Verify that <span class="msg">IssuerRequest</span> schema-wise is properly formatted.
      </li>
      <li>
        Verify that the <code>timeStamp</code> is within &quot;reasonable limits&quot;.
      </li>
      <li>
        Verify that the <code>pspRequest.fwpAssertion.paymentNetworkId</code> is supported.
      </li>
      <li>
        Verify that the <code>pspRequest.receiveAccount</code>
        is compatible with the <code>pspRequest.fwpAssertion.paymentNetworkId</code>.
      </li>
      <li>
        Verify that the <code>pspRequest.fwpAssertion.issuerId</code>
        is compatible with the <code>pspRequest.fwpAssertion.paymentNetworkId</code>
        as well as matching the <b class="actor">Issuer</b>.
      </li>
      <li>
        Verify that <code>pspRequest.paymentRequest</code>
        represents a valid <a href="#seq-4.1">PRCD</a> object.
      </li>
    </ul>
    <div id="seq-10.2" class="step">
      10.2 Extract Signed Authorization Data (SAD)
    </div>
    <ul>
      <li>
        Decode the Base64Url string supplied in <code>pspRequest.fwpAssertion.userAuthorization</code>.
      </li>
      <li>
        Parse the result of the previous operation as CBOR and set result as <a href="#seq-4.4">ESAD</a>.
      </li>
      <li>
        Verify that the COTX object Id is supported.
      </li>
      <li>
        Verify that the resulting object is compatible with the encryption profile specified by FWP.
      </li>
      <li>
        Verify that the public key or key Id declared in the encrypted object matches an
        existing decryption (private) key of the <b class="actor">Issuer</b>.
      </li>
      <li>
        Decrypt the ESAD object using the private key retrieved in the previous operation.
      </li>
      <li>
        Parse the result of the previous operation as CBOR and set result as <a href="#seq-4.3">SAD</a>.
      </li>
      <li>
        Verify that the SAD object schema-wise has the proper format.
      </li>
    </ul>
    <div id="seq-10.3" class="step">
      10.3 Validate Request Data
    </div>
    <ul>
      <li>
        Verify that <code>pspRequest.paymentRequest</code> is equivalent to <code>SAD.paymentRequest</code>.
        That is, verifying that the <b class="actor">Merchant</b> payment claim corresponds to what the
        <b class="actor">User</b> have actually <i>seen and authorized</i>.
      </li>
      <li>
        Verify that <code>pspRequest.payeeHost</code> is equivalent to <code>SAD.payeeHost</code>.
        That is, verifying that the <b class="actor">User</b> was not subject to phishing.
        Note that phishing attacks against FWP are not useful for stealing money,
        but for redirecting purchased goods to another address.
      </li>
      <li id="expired">
        Verify that the <code>SAD.timeStamp</code> is within &quot;reasonable limits&quot;.
        <i>Tentative:</i> CurrentTime - 600s &lt; <code>SAD.timeStamp</code> &lt; CurrentTime + 60s.
      </li>
      <li>
        Verify that the <i>optional</i> <code>SAD.networkOptions</code> attribute complies
        with the specific requirements of the <b class="actor">Issuer</b>.
      </li>
    </ul>

    <div id="seq-10.4" class="step">
      10.4 Validate Authorization Signature
    </div>
    <ul>
      <li>
        Verify the signature of the recovered SAD object.
        Since the public key is included in the signature container, signature validation
        does not require database lookups.
      </li>
      <li>
        Verify that the aforementioned public key is linked to a <b class="actor">User</b>
        account matching the <code>SAD.accountId</code> and <code>SAD.serialNumber</code> attributes
        (where the latter would typically serve as the primary key in a credential database table).
        Note that this check requires that the public key is in a <i>canonical form</i>.
        Fortunately, this is a &quot;built-in&quot; feature if public keys are stored in the COSE format.
        <div class="gutter">
          Using SHA256 hashes of public keys is a common method for limiting the
          the need storing and comparing large keys (like required by the RSA algorithm).
        </div>
      </li>
    </ul>
    <div id="seq-10.5" class="step">
      <div id="replayhandling">10.5 Replay Handling</div>
    </div>
    <div>
      To cope with possible replays, verify that the received <b class="actor">User</b> authorization
      has not already been used. This can be accomplished by maintaining a lookup cache
      holding received <a href="#seq-4.3">SAD</a> objects.
      Due to the unique, <i>account specific</i> data featured in SAD objects,
      authorizations associated with different accounts may share a common cache.
      Since authorization signatures encompass variant data like
      the <code>timeStamp</code> and <code>paymentRequest</code> elements,
      as well as the signature counter in FIDO <code>authenticatorData</code> objects,
      false cache collisions on individual SAD objects should be
      &quot;impossible&quot;, also in the cryptographic sense.
      Cached SAD objects can safely be removed <a href="#expired">when expired</a>,
      preferable using a background process.
    </div>
    <div class="para">
      See <a href="https://github.com/fido-web-pay/specification/blob/gh-pages/replay-cache-java.md#replay-cache---java-sample"
             title="Replay Cache">Replay Cache<img src="images/xtl.svg" alt="link"></a>
      for a sample in Java.
    </div>
    <div class="para">
      Note that using this scheme, SAD objects MUST be <i>fully validated</i> before being
      added to the cache!
    </div>
    <div class="comment box">
      Ideally, <b class="actor">Issuer</b>s
      SHOULD support <i>idempotent operation</i> to facilitate transaction retries
      that may happen due to network glitches or similar.
    </div>
    <div id="seq-10.6" class="step">
      10.6 Other Validation Steps
    </div>
    <div>
      Obviously there are other things to verify but these are not directly related to FWP,
      like checking that the <b class="actor">User</b> has funds available matching the
      current request.
    </div>
      
    <div id="delegatedauthorization" class="header">
      8. Delegated Authorization
    </div>
    <div>
      Using delegated authorization the validation
      of <b class="actor">User</b> authorizations is separated
      from payment initiations. The purpose with such arrangements include:
    </div>
    <ul>
      <li>Ease the integration of FWP in existing payment systems.</li>
      <li>Open the possibility <i>outsourcing</i> the authorization process to TPPs.</li>
      <li>
        Provide an <a href="#seq-2">enhanced UX</a> to payment systems based on
        <a href="#openbanking">Open Banking</a> APIs.
      </li>
    </ul>
    <div class="para">
      Note that FWP makes the use of delegated authorization <i>transparent</i>
      for both the <b class="actor">User</b> and the <b class="actor">Merchant</b>.
    </div>
    <div class="para">
      Delegated authorization differs from
      <a href="https://www.emvco.com/emv-technologies/3d-secure/"
          title="3DS Site">3D&nbsp;Secure<img src="images/xtl.svg" alt="link"></a>
      by keeping the authorization process and associated <b class="actor">User</b>
      account information, inside of the core payment network.
      This enables validation of potentially <i>untrusted</i> <b class="actor">Merchant</b>
      data as well as eliminating dependencies on certified <b class="actor">Merchant</b>
      3D&nbsp;Secure SDKs.
    </div>
    <div class="para">
      Delegated authorization builds on the assumption that the <b class="actor">PSP</b> is trusted
      for carrying out payment initiations on behalf of a <b class="actor">User</b>
      (based on a preceding <b class="actor">User</b> authorization step),
      which is an established concept in most payment networks.
      (In the FWP standard mode the <b class="actor">PSP</b> only acts as a proxy
      for the <b class="actor">Merchant</b>).
    </div>
    <div class="para">
      The delegated authorization mode is illustrated by the following sequence diagram:
    </div>
    <div style="overflow-x:auto;padding:8pt 0">
      <svg style='display:block;width:400pt' class='box' viewBox='0 0 486 355' xmlns='http://www.w3.org/2000/svg'>
    <title>FIDO Web Pay - Sample Delegated Sequence Diagram</title>
    <!-- Anders Rundgren 2021 -->
    
  <line x1='63' y1='67' x2='63' y2='345' stroke-width='1.2' stroke='black'/>
  <line x1='183' y1='67' x2='183' y2='345' stroke-width='1.2' stroke='black'/>
  <line x1='303' y1='67' x2='303' y2='345' stroke-width='1.2' stroke='black'/>
  <line x1='423' y1='67' x2='423' y2='345' stroke-width='1.2' stroke='black'/>
<svg x='34.66666666666667' y='32.0' width='56.666666666666664' height='40.0'
   xmlns='http://www.w3.org/2000/svg'
   viewBox='0 0 68 48'
   version='1.1'>
  <title>Merchant Symbol</title>
  <!-- Anders Rundgren 2021-->
  
  <g
     clip-path='url(#clip3)'
     filter='url(#fx0)'
     transform='translate(1,12)'>
    <g
       clip-path='url(#clip4)'>
      <rect
         x='12.3285'
         y='7.3284798'
         width='45'
         height='27'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'/>
      <rect
         x='16.328501'
         y='15.3285'
         width='9'
         height='20'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ebf1de'/>
      <rect
         x='0'
         y='0'
         width='14'
         height='22'
         stroke='#8eb4e3'
         stroke-width='2'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#dce6f2'
         transform='matrix(0,-1,-1,0,51.8284,28.8284)'/>
      <path
         d='m 25.3285,25.3285 1e-4,1e-4'
         stroke='#4a7ebb'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='none'
         fill-rule='evenodd'/>
      <rect
         x='7.3284898'
         y='34.328499'
         width='54'
         height='2'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#fdfac7'/>
    </g>
  </g>
  <rect
     x='12.5'
     y='18.500099'
     width='45'
     height='27'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='url(#fill5)'
     style='fill:url(#fill5)' />
  <rect
     x='16.5'
     y='26.500099'
     width='9'
     height='20'
     stroke='#7f7f7f'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ebf1de'/>
  <rect
     x='-40'
     y='-52'
     width='14'
     height='22'
     stroke='#8eb4e3'
     stroke-width='1.66667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#dce6f2'
     transform='matrix(0,-1,-1,0,0,0)' />
  <path
     d='m 25.5,36.5001 v 10e-5'
     stroke='#4a7ebb'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='none'
     fill-rule='evenodd' />
  <g
     clip-path='url(#clip6)'
     filter='url(#fx1)'
     transform='translate(0,-4)'>
    <g
       clip-path='url(#clip7)'>
      <path
         d='m 7.32849,24.8285 c 0,-0.8285 1.567,-1.5 3.50001,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.93301,0 -3.50001,-0.6716 -3.50001,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'
         fill-rule='evenodd' />
      <path
         d='m 20.3285,24.8285 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'
         fill-rule='evenodd' />
      <path
         d='m 33.3285,24.8285 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'
         fill-rule='evenodd' />
      <path
         d='m 46.3285,24.8285 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'
         fill-rule='evenodd' />
      <path
         d='m 59.3285,24.8285 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'
         fill-rule='evenodd' />
      <path
         d='m 14.3285,24.8285 c 0,-0.8285 1.3431,-1.5 3,-1.5 1.6568,0 3,0.6715 3,1.5 0,0.8284 -1.3432,1.5 -3,1.5 -1.6569,0 -3,-0.6716 -3,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff'
         fill-rule='evenodd' />
      <path
         d='m 27.3285,24.8285 c 0,-0.8285 1.3431,-1.5 3,-1.5 1.6568,0 3,0.6715 3,1.5 0,0.8284 -1.3432,1.5 -3,1.5 -1.6569,0 -3,-0.6716 -3,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff'
         fill-rule='evenodd' />
      <path
         d='m 40.3285,24.8285 c 0,-0.8285 1.3431,-1.5 3,-1.5 1.6568,0 3,0.6715 3,1.5 0,0.8284 -1.3432,1.5 -3,1.5 -1.6569,0 -3,-0.6716 -3,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff'
         fill-rule='evenodd' />
      <path
         d='m 53.3285,24.8285 c 0,-0.8285 1.3431,-1.5 3,-1.5 1.6568,0 3,0.6715 3,1.5 0,0.8284 -1.3432,1.5 -3,1.5 -1.6569,0 -3,-0.6716 -3,-1.5 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff'
         fill-rule='evenodd' />
      <path
         d='M 0,17 V 0 l 7,17 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'
         fill-rule='evenodd'
         transform='matrix(-1,0,0,1,14.3285,7.32848)' />
      <rect
         x='20.328501'
         y='7.3284798'
         width='7'
         height='17'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000' />
      <rect
         x='33.328499'
         y='7.3284798'
         width='7'
         height='17'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000' />
      <rect
         x='46.328499'
         y='7.3284798'
         width='7'
         height='17'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000' />
      <path
         d='M 59.3285,24.3285 V 7.32848 l 7,17.00002 z'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ff0000'
         fill-rule='evenodd' />
      <rect
         x='14.3285'
         y='7.3284798'
         width='6'
         height='17'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff' />
      <rect
         x='27.328501'
         y='7.3284798'
         width='6'
         height='17'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff' />
      <rect
         x='40.328499'
         y='7.3284798'
         width='6'
         height='17'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff' />
      <rect
         x='53.328499'
         y='7.3284798'
         width='6'
         height='17'
         stroke='#7f7f7f'
         stroke-linejoin='round'
         stroke-miterlimit='10'
         fill='#ffffff' />
    </g>
  </g>
  <path
     d='m 4.5,18.0001 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000'
     fill-rule='evenodd' />
  <path
     d='m 17.5,18.0001 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000'
     fill-rule='evenodd' />
  <path
     d='m 30.5,18.0001 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000'
     fill-rule='evenodd' />
  <path
     d='m 43.5,18.0001 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000'
     fill-rule='evenodd' />
  <path
     d='m 56.5,18.0001 c 0,-0.8285 1.567,-1.5 3.5,-1.5 1.933,0 3.5,0.6715 3.5,1.5 0,0.8284 -1.567,1.5 -3.5,1.5 -1.933,0 -3.5,-0.6716 -3.5,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000'
     fill-rule='evenodd' />
  <path
     d='m 11.5,18.0001 c 0,-0.8285 1.343,-1.5 3,-1.5 1.657,0 3,0.6715 3,1.5 0,0.8284 -1.343,1.5 -3,1.5 -1.657,0 -3,-0.6716 -3,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff'
     fill-rule='evenodd' />
  <path
     d='m 24.5,18.0001 c 0,-0.8285 1.343,-1.5 3,-1.5 1.657,0 3,0.6715 3,1.5 0,0.8284 -1.343,1.5 -3,1.5 -1.657,0 -3,-0.6716 -3,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff'
     fill-rule='evenodd' />
  <path
     d='m 37.5,18.0001 c 0,-0.8285 1.343,-1.5 3,-1.5 1.657,0 3,0.6715 3,1.5 0,0.8284 -1.343,1.5 -3,1.5 -1.657,0 -3,-0.6716 -3,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff'
     fill-rule='evenodd' />
  <path
     d='m 50.5,18.0001 c 0,-0.8285 1.343,-1.5 3,-1.5 1.657,0 3,0.6715 3,1.5 0,0.8284 -1.343,1.5 -3,1.5 -1.657,0 -3,-0.6716 -3,-1.5 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff'
     fill-rule='evenodd' />
  <path
     d='m 11.5,17.5001 v -17 l -7,17 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000'
     fill-rule='evenodd' />
  <rect
     x='17.5'
     y='0.50009918'
     width='7'
     height='17'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000' />
  <rect
     x='30.5'
     y='0.50009918'
     width='7'
     height='17'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000' />
  <rect
     x='43.5'
     y='0.50009918'
     width='7'
     height='17'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000' />
  <path
     d='m 56.5,17.5001 v -17 l 7,17 z'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ff0000'
     fill-rule='evenodd' />
  <rect
     x='11.5'
     y='0.50009918'
     width='6'
     height='17'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff' />
  <rect
     x='24.5'
     y='0.50009918'
     width='6'
     height='17'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff' />
  <rect
     x='37.5'
     y='0.50009918'
     width='6'
     height='17'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff' />
  <rect
     x='50.5'
     y='0.50009918'
     width='6'
     height='17'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#ffffff' />
  <rect
     x='7.5'
     y='45.5'
     width='54'
     height='2'
     stroke='#7f7f7f'
     stroke-width='0.666667'
     stroke-linejoin='round'
     stroke-miterlimit='10'
     fill='#fdfac7' />
</svg>
  <text x='63' y='24.3' fill='black' font-family='Roboto,sans-serif' font-size='14.399999999999999' text-anchor='middle'>Merchant</text>
<svg x='163' y='32.0' width='40' height='40.0' viewBox='0 0 1000 1000' xmlns='http://www.w3.org/2000/svg'>
  <title>PSP Symbol</title>
  <!-- Anders Rundgren 2021 -->
  
  <rect x='7.5' y='7.5' width='985' height='985' rx='70' fill='white' stroke='grey' stroke-width='15'/>
  <path stroke='#009a00' stroke-width='20' fill='url(#bigGearGid)' d='M399.9,799.7 456.2,902.6 479,896.5 476.3,779.3 493.5,769.3 593.6,830.3 610.3,813.6 549.3,713.5 559.3,696.3 676.5,699 682.6,676.2 579.7,619.9 579.7,600.1 682.6,543.8 676.5,521 559.3,523.7 549.3,506.5 610.3,406.4 593.6,389.7 493.5,450.7 476.3,440.7 479,323.5 456.2,317.4 399.9,420.3 380.1,420.3 323.8,317.4 301,323.5 303.7,440.7 286.5,450.7 186.4,389.7 169.7,406.4 230.7,506.5 220.7,523.7 103.5,521 97.4,543.8 200.3,600.1 200.3,619.9 97.4,676.2 103.5,699 220.7,696.3 230.7,713.5 169.7,813.6 186.4,830.3 286.5,769.3 303.7,779.3 301,896.5 323.8,902.6 380.1,799.7 z'/>
  <circle stroke='grey' stroke-width='15' fill='url(#shaftGid)' r='80' cx='390' cy='610'/>
  <path stroke='#f27b2b' stroke-width='20' fill='url(#smallGearGid)' d='M656.4,357.2 661.5,471.3 692.2,478.1 745,376.8 755,373.7 856.4,426.3 877.6,403.1 816.4,306.7 818.6,296.5 914.9,235 905.4,205.1 791.3,209.9 783.6,202.8 778.5,88.7 747.8,81.9 695,183.2 685,186.3 583.6,133.7 562.4,156.9 623.6,253.3 621.4,263.5 525.1,325 534.6,354.9 648.7,350.1 z'/>
  <circle stroke='grey' stroke-width='15' fill='url(#shaftGid)' r='50' cx='720' cy='280'/>
</svg>  <text x='183' y='24.3' fill='black' font-family='Roboto,sans-serif' font-size='14.399999999999999' text-anchor='middle'>PSP</text>
<svg x='283' y='32.0' width='40' height='40.0' viewBox='0 0 1000 1000' xmlns='http://www.w3.org/2000/svg'>
  <title>Authorizer Symbol</title>
  <!-- Anders Rundgren 2021 -->
  <defs>
    <filter id='shackleGlow'>
      <feGaussianBlur stdDeviation='2'/>
    </filter>
    <linearGradient id='goldenLock' x1='0' x2='1' y1='0.3' y2='0.6'>
      <stop offset='0.1' stop-color='#f0d100'/>
      <stop offset='0.5' stop-color='#f7f5dc'/>
      <stop offset='0.9' stop-color='#f0d100'/>
    </linearGradient>
    <linearGradient id='serverGloss' x1='0' x2='1' y1='0.3' y2='0.7'>
      <stop offset='0' stop-color='#d2ddef'/>
      <stop offset='0.5' stop-color='#edf2ff'/>
      <stop offset='1' stop-color='#d2ddef'/>
    </linearGradient>
    <radialGradient cx='0.5' cy='0.5' id='powerOn' r='0.5'>
      <stop offset='0' stop-color='#eaebef'/>
      <stop offset='1' stop-color='#ff5656'/>
    </radialGradient>
  </defs>
  <rect x='7.5' y='7.5' width='985' height='985' rx='70' fill='white' stroke='grey' stroke-width='15'/>
   <line stroke='#4ca7e0' x1='160' y1='86' x2='160' y2='950' stroke-width='25'/>
   <line stroke='#4ca7e0' x1='840' y1='86' x2='840' y2='950' stroke-width='25'/>
  <rect fill='url(#serverGloss)' x='85' y='86' width='830' height='180' rx='40' stroke='#7f7f7f' stroke-width='10'/>
  <circle cx='149' cy='150' fill='url(#powerOn)' r='32' stroke='#333333' stroke-width='5'/>
  <rect fill='#dae3f3' height='126' stroke='#7f7f7f' stroke-width='10' width='20' x='245' y='113'/>
  <rect fill='#dae3f3' height='126' stroke='#7f7f7f' stroke-width='10' width='20' x='315' y='113'/>
  <rect fill='#dae3f3' height='126' stroke='#7f7f7f' stroke-width='10' width='20' x='385' y='113'/>
  <rect fill='url(#serverGloss)' x='85' y='302' width='830' height='180' rx='40' stroke='#7f7f7f' stroke-width='10'/>
  <circle cx='149' cy='366' fill='url(#powerOn)' r='32' stroke='#333333' stroke-width='5'/>
  <rect fill='#dae3f3' height='126' stroke='#7f7f7f' stroke-width='10' width='20' x='245' y='329'/>
  <rect fill='#dae3f3' height='126' stroke='#7f7f7f' stroke-width='10' width='20' x='315' y='329'/>
  <rect fill='#dae3f3' height='126' stroke='#7f7f7f' stroke-width='10' width='20' x='385' y='329'/>
  <rect fill='url(#serverGloss)' x='85' y='518' width='830' height='180' rx='40' stroke='#7f7f7f' stroke-width='10'/>
  <circle cx='149' cy='582' fill='url(#powerOn)' r='32' stroke='#333333' stroke-width='5'/>
  <rect fill='#dae3f3' height='126' stroke='#7f7f7f' stroke-width='10' width='20' x='245' y='545'/>
  <rect fill='#dae3f3' height='126' stroke='#7f7f7f' stroke-width='10' width='20' x='315' y='545'/>
  <rect fill='#dae3f3' height='126' stroke='#7f7f7f' stroke-width='10' width='20' x='385' y='545'/>
  <rect fill='url(#serverGloss)' x='85' y='734' width='830' height='180' rx='40' stroke='#7f7f7f' stroke-width='10'/>
  <circle cx='149' cy='798' fill='url(#powerOn)' r='32' stroke='#333333' stroke-width='5'/>
  <rect fill='#dae3f3' height='126' stroke='#7f7f7f' stroke-width='10' width='20' x='245' y='761'/>
  <rect fill='#dae3f3' height='126' stroke='#7f7f7f' stroke-width='10' width='20' x='315' y='761'/>
  <rect fill='#dae3f3' height='126' stroke='#7f7f7f' stroke-width='10' width='20' x='385' y='761'/>
  <path fill='none' stroke='#808080' stroke-width='60' d='M580,786 L580,676 C580,651 605,626 630,626 L670,626 C695,626 720,651 720,676 L720,786'/>
  <path fill='none' stroke='#b0b0b0' stroke-width='40' d='M580,786 L580,676 C580,651 605,626 630,626 L670,626 C695,626 720,651 720,676 L720,786'/>
  <path fill='none' stroke='white' stroke-width='14' filter='url(#shackleGlow)' d='M580,786 L580,676 C580,651 605,626 630,626 L670,626 C695,626 720,651 720,676 L720,786'/>
  <rect fill='url(#goldenLock)' x='520' y='786' width='260' height='160' rx='25' stroke='#7f7f7f' stroke-width='10'/>
</svg>  <text x='303' y='24.3' fill='black' font-family='Roboto,sans-serif' font-size='14.399999999999999' text-anchor='middle'>Authorizer</text>
<svg x='392.44444444444446' y='32.0' width='61.111111111111114' height='40.0' viewBox='0 0 110 72' xmlns='http://www.w3.org/2000/svg'>
  <title>Issuer Symbol</title>
  <!-- Anders Rundgren 2021-->
  
  <rect x='11' y='17' width='88' height='50' fill='white'/>
  <g fill='#b0b0b0' filter='url(#bankShaddow)'>
    <path d='m19.5,17.5l21.67,0l0,11l-10.67,0l0,35.5l-11,0'/>
    <path d='m41,17.5l21.67,0l0,11l-10.67,0l0,35.5l-11,0'/>
    <path d='m62.5,17.5l21.67,0l0,11l-10.67,0l0,35.5l-11,0'/>
    <path d='m 84,17.5 h 17 v 11 H 95 V 64 H 84'/>
  </g>
  <rect fill='url(#bankPillar)' height='37.5' width='11' x='17' y='26'/>
  <rect fill='url(#bankPillar)' height='37.5' width='11' x='38.66' y='26'/>
  <rect fill='url(#bankPillar)' height='37.5' width='11' x='60.33' y='26'/>
  <rect fill='url(#bankPillar)' height='37.5' width='11' x='82' y='26'/>
  <path d='m10.3,16 l44.70,-15 l44.70,15' fill='url(#bankRoof)' stroke='grey' stroke-width='1' stroke-linecap='round'/>
  <g stroke-width='0.7' stroke='grey'>
  <rect fill='url(#bankFront)' height='10' width='90' x='10' y='16'/>
  <rect fill='url(#bankFront)' height='4' width='100' x='5' y='67.5'/>
  <rect fill='url(#bankFront)' height='4' width='90' x='10' y='63.5'/>
  </g>
  <text x='55' y='23.9' font-size='8' font-weight='bold' font-family='Roboto,sans-serif' text-anchor='middle' fill='#707070'>
B&#xa0;&#xa0;A&#xa0;&#xa0;N&#xa0;&#xa0;K
</text>
</svg>
  <text x='423' y='24.3' fill='black' font-family='Roboto,sans-serif' font-size='14.399999999999999' text-anchor='middle'>Issuer</text>
  <line x1='63.6' y1='100' x2='174.9' y2='100' stroke-width='0.8' stroke='#cc1010' marker-end='url(#arrowHead)'/>
  <text x='123' y='94.7' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>PSPRequest</text>
  <a href='#seq-7'>
  <rect x='56' y='93' width='14' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='63' y='104.3' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>7</text>
  </a>
  <path fill='black' opacity='0.4' d='M146,118.75 l86,0 l-8,22 l-86,0Z' filter='url(#dropShaddow)'/>
  <path fill='#faf2dd' stroke='#404040' stroke-width='0.5' d='M144,116.75 l86,0 l-8,22 l-86,0Z'/>
  <text x='185.8' y='132.05' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>Processing</text>
  <a href='#seq-D1'>
  <rect x='129.25' y='120.75' width='21' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='139.75' y='132.05' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>D1</text>
  </a>
  <line x1='183.6' y1='164' x2='294.9' y2='164' stroke-width='0.8' stroke='#cc1010' marker-end='url(#arrowHead)'/>
  <text x='243' y='158.70000000000002' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>&#160;&#160;AuthorizeRequest</text>
  <a href='#seq-D2'>
  <rect x='172.5' y='157' width='21' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='183' y='168.3' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>D2</text>
  </a>
  <path fill='black' opacity='0.4' d='M266,182.75 l86,0 l-8,22 l-86,0Z' filter='url(#dropShaddow)'/>
  <path fill='#faf2dd' stroke='#404040' stroke-width='0.5' d='M264,180.75 l86,0 l-8,22 l-86,0Z'/>
  <text x='305.8' y='196.05' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>Processing</text>
  <a href='#seq-D3'>
  <rect x='249.25' y='184.75' width='21' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='259.75' y='196.05' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>D3</text>
  </a>
  <line x1='302.4' y1='228' x2='191.1' y2='228' stroke-width='0.8' stroke='#009000' marker-end='url(#arrowReturnHead)'/>
  <text x='243' y='222.70000000000002' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>Authorization</text>
  <a href='#seq-D4'>
  <rect x='292.5' y='221' width='21' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='303' y='232.3' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>D4</text>
  </a>
  <path fill='black' opacity='0.4' d='M146,246.75 l86,0 l-8,22 l-86,0Z' filter='url(#dropShaddow)'/>
  <path fill='#faf2dd' stroke='#404040' stroke-width='0.5' d='M144,244.75 l86,0 l-8,22 l-86,0Z'/>
  <text x='185.8' y='260.05' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>Processing</text>
  <a href='#seq-D5'>
  <rect x='129.25' y='248.75' width='21' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='139.75' y='260.05' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>D5</text>
  </a>
  <line x1='183.6' y1='292' x2='414.9' y2='292' stroke-width='0.8' stroke='#cc1010' marker-end='url(#arrowHead)'/>
  <text x='243' y='286.7' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>&quot;Payment Rails&quot;</text>
  <a href='#seq-D6'>
  <rect x='172.5' y='285' width='21' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='183' y='296.3' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>D6</text>
  </a>
  <path fill='black' opacity='0.4' d='M386,310.75 l86,0 l-8,22 l-86,0Z' filter='url(#dropShaddow)'/>
  <path fill='#faf2dd' stroke='#404040' stroke-width='0.5' d='M384,308.75 l86,0 l-8,22 l-86,0Z'/>
  <text x='425.8' y='324.05' fill='black' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>Processing</text>
  <a href='#seq-D7'>
  <rect x='369.25' y='312.75' width='21' height='14' rx='3' fill='white' stroke='#404040' stroke-width='0.5'/>
  <text x='379.75' y='324.05' fill='#4366ff' font-family='Roboto,sans-serif' font-size='12' text-anchor='middle'>D7</text>
  </a>
</svg>
    </div>
    <div>
      Note that step 1-7 are <i>identical</i> to the FWP &quot;standard&quot; mode.
      &quot;Payment Rails&quot; refer to existing payment systems.
    </div>
    <div class="para">
      In an <a href="#openbanking">Open Banking</a> context the <b class="actor">PSP</b> would be equivalent to a PISP while
      the <b class="actor">Authorizer</b> would be a specialized AS.
    </div>
    <div class="step"><div id="seq-D1" class="numbox">D1</div>Process PSPRequest and Create AuthorizeRequest Object</div>
    <div>
      This step should involve the same verifications as in <a href="#seq-8">step 8</a>
      in the standard mode.
      A suitable <span class="msg">AuthorizeRequest</span> object would typically follow the
      <span class="msg">IssuerRequest</span> sample in step 8.
    </div>
    <div class="comment box">
      Using delegated authorization may be decided by each <b class="actor">Issuer</b>
      <i>individually</i>.  The actual configuration is preferably resolved by making
      the <code>issuerId</code> attribute play the role of a <a href="#servicediscovery">Service Discovery URL</a>.
    </div>
    <div class="step"><div id="seq-D2" class="numbox">D2</div>Send AuthorizeRequest Object</div>
    <div>
      At this point the <b class="actor">PSP</b> sends the completed <span class="msg">AuthorizeRequest</span>
      object to the designated <b class="actor">Authorizer</b>.
      Note that the method used for locating the proper <b class="actor">Authorizer</b> depends on
      the <code>paymentNetworkId</code> and <code>issuerId</code> attributes.
    </div>
    <div class="step"><div id="seq-D3" class="numbox">D3</div>Process AuthorizeRequest</div>
    <div>
      This step should involve the same verifications as in <a href="#seq-10">step 10</a>
      in the standard mode.
    </div>
    <div class="step"><div id="seq-D4" class="numbox">D4</div>Return Authorized Data</div>
    <div>
      If the preceding step is successful, <span class="msg">AuthorizeRequest</span>
      would typically return the (now decrypted) <b class="actor">User</b> account number.
    </div>
    <div id="delegatedreturnoptions" class="comment box">
      A more sophisticated approach would be to return signed data for maintaining the
      end-to-end security model.  For card payments this would preferably be in the
      form of EMV compliant objects that can be passed on to existing payment systems
      &quot;as&nbsp;is&quot;.
    </div>
    <div id="openbanking">
      &nbsp;<br>In an Open Banking implementation based on OAuth2 concepts,
      the return data would contain access tokens and consent information.
    </div>
    <div class="step"><div id="seq-D5" class="numbox">D5</div>Create Payment Instruction</div>
    <div>
      After receiving the <b class="actor">User</b> account number a
      <span class="msg">payment instruction</span> object is created.
      The format and contents of such objects are payment network specific and
      are therefore not described here.
    </div>
    <div class="step"><div id="seq-D6" class="numbox">D6</div>Invoke &quot;Payment Rails&quot;</div>
    <div>
      Perform a <span class="msg">payment instruction</span> request in a payment network specific way.
    </div>
    <div class="step"><div id="seq-D7" class="numbox">D7</div>Process Payment Instruction</div>
    <div>
      Process the <span class="msg">payment instruction</span>
      request in a payment network specific way.
    </div>

<div id="security" class="header">
  Security and Privacy Considerations
</div>
<div>
  Security in FWP depends to a large extent on the W3C
  <a href="https://www.w3.org/TR/payment-request/"
     title="PaymentRequest">PaymentRequest<img src="images/xtl.svg" alt="link"></a> API
  which acts as a &quot;mediator&quot; between the untrusted Web and payment applications.
  That does though not stop arbitrary Web sites from invoking FWP when the user clicks a
  link on the site.
  However, if the site does not represent a genuine merchant, even a completed user authorization
  will not lead to a security breach, because properly designed backend systems should
  block the rest of the process since the requester would not be recognized.
  If on the other hand the site is legitimate, the assumption is that in order to
  become a merchant entitled to request payments, you usually need to follow specific rules 
 regarding how and when payments requests may be performed.
</div>
<div class="para">
  Due to the end-to-end security model, card numbers and similar personally identifiable information
  (PII) are protected from illicit access, as long as payment providers manage FWP
  decryption keys in a secure manner.
</div>
<div class="para">
  It is technically possible creating Web applications that look like FWP (&quot;spoofing&quot;),
  but such applications are not able producing valid assertions since that requires
  unconstrained access to FIDO keys which is reserved for FWP (which runs
  with higher privileges than ordinary Web code).
</div>
<div class="para">
  If the internal clock of an FWP client is severely <a href="#expired">out of sync</a>, associated
  authorizations should be rejected.
  This makes clock manipulations useless as attack vectors.
</div>
<div class="para">
  FWP depends on that the underlying software is operating
  correctly. Bugs or successful attacks on the platform may force the FWP system
  to perform payments in the background or violate the user's privacy.
</div>
<div class="para">
  Although FWP was designed with privacy in mind, it does add some
  data which (to a rather limited extent),
  can be used by merchants for &quot;binning&quot; users:
 </div>
<ul>
  <li>
    Each authorization returns a <i>non-personal</i> payment network identfier.
  </li>
  <li>
    Each authorization returns a <i>non-personal</i> bank identifier.  This information
    provides a crude estimate of where the user may live.
  </li>
  <li>
    The availability of FWP itself represents user related data.
  </li>
</ul>
<div id="integration" class="header">
      Integration
    </div>
    <div>
      It goes without saying that the integration of systems like FWP in
      payment networks is crucial for acceptance by the market.
    </div>
    <div class="para">
      For card based payments FWP implementations can build on the existing
      EMV foundation since essentially only the formats differ.
      Although the lack of a PAN (card number) in FWP may appear as an obstacle,
      the <code>issuerId</code> would in this case hold a &quot;neutered&quot; PAN where
      the BIN (Bank Identification Number) is set, while the rest are set to zeroes + Luhn check digit.
      E.g. VISA: 4972039000000004.  However, using <b class="actor">Issuer</b> URLs
      is also a viable alternative for card payments because payment processors
      associated with &quot;regular&quot; EMV and FWP payments would probably not
      share end points.
    </div>
    <div class="para">
      For account-to-account payments there are currently no generally agreed upon standards
      for consumer payments, but remapping existing card based systems and infrastructures
      seems though like a possible path.
    </div>
    <div class="para">
      <a href="#delegatedauthorization">Delegated Authorization</a>
      represents yet another way addressing payment system integration.
    </div>

<div id="extensions" class="header">
      Extensions
    </div>
    <div>
      The FWP <i>client</i> is loosely derived from a proof-of-concept system called
      <a href="https://cyberphone.github.io/doc/saturn/"
          title="Saturn">Saturn<img src="images/xtl.svg" alt="link"></a>.
      By continuing along this path, features like the following could potentially be added:
    </div>
    <ul>
      <li>
        Support for <i>non-direct payments</i>,
        including secure (<i>tokenized</i>) versions of Card-on-File.
      </li>
      <li>
        Support for real-time <i>account balances</i>.
      </li>
      <li>
        Support for <b class="actor">User</b> <i>refunding</i>.
      </li>
      <li>
        Support for universal <i>digital receipts</i>.
      </li>
      <li>
        Support for <i>private messaging</i> and additional authentication information between the
        <b class="actor">Issuer</b> and <b class="actor">User</b>.
      </li>
    </ul>
    <div class="para">
      Note that <i>some</i> of the features above could impact the PaymentRequest API.
    </div>
    <div id="implementationoptions" class="header">
      Implementation Options
    </div>
    <div>
      An alternative to building FWP support into browsers, is moving the FWP implementation
      (including the <a href="#credentialdatabase">credential database</a>), down into the client platform layer.
      This would open FWP to other scenarios like:
    </div>
    <ul style="margin-bottom:0.3em">
      <li>
        Point-of-sale (PoS) payments.
        This would (at least <i>initially</i>) depend on QR-code for invocation.
      </li>
      <li>
        Person-to-person (P2P) payments.
      </li>
    </ul>
    <div class="para">
      Such an arrangement would also introduce additional features including:
    </div>
    <ul>
      <li>
        Making it easier for alternative browser vendors adopting the FWP system
        since they would not have to build a copy of FWP themselves;
        a thin wrapper should suffice.
      </li>
      <li>
        Relieving users from having to enroll payment credentials
        for each browser they want to use.
      </li>
      <li>
        Limiting the number of systems to certify in the case certification
        becomes a requirement.
      </li>
    </ul>
 
    <div id="cbor" class="header">
    Usage of CBOR
    </div>
    <div>
      That the <i>internals</i> of FWP assertions are based on CBOR rather than JSON may
      seem odd since CBOR currently is not particularly common on the Web.
      However, there is a pretty strong rationale for using CBOR for this
      application including:
    </div>
    <ul>
      <li>
        The <i>deterministic mode</i> of <a href="https://tools.ietf.org/html/rfc8949"
        title="RFC8949">RFC8949<img src="images/xtl.svg" alt="link"></a>
        offers the following advantages:
        <ul>
          <li>
            Simplified cryptographic operations, not needing specific canonicalization support or
            awkward Base64Url encoding of data to be signed.
          </li>
          <li>
            Elements always appear at the same position, making documentation
            matching actual data.
          </li>
        </ul>
      </li>
      <li>
        Denser code.
      </li>
      <li>
        FWP assertions are (due to the end-to-and security model), only processable by
        the <b class="actor">Issuer</b> and possible <a href="#delegatedauthorization">delegated parties</a>.
      </li>
      <li>
        FIDO attestations require CBOR support.
      </li>
    </ul>
     <div id="cbortypes" class="para box comment">
      To maintain <i>simple and deterministic</i> representation of data, this specification
      only uses a subset of CBOR.  Extensions to this specification SHOULD&nbsp;NOT
      introduce additional CBOR primitives beyond floating point and big number.
    </div>
    <div id="acknowledgements" class="header">
      Acknowledgements
    </div>
    <div>
      The FWP core was heavily influenced by an earlier Microsoft research project
      called <a href="https://en.wikipedia.org/wiki/Windows_CardSpace"
                title="CardSpace">Windows CardSpace<img src="images/xtl.svg" alt="link"></a>.
    </div>
    <div class="para">
      The <b class="actor">User</b> icon was derived from
      <a style="word-break:break-all;white-space:normal"
          href="https://commons.wikimedia.org/wiki/File:Crystal_Clear_kdm_user_female.svg"
          title="User Icon">
        https://commons.wikimedia.org/wiki/File:Crystal_Clear_kdm_user_female.svg<img src="images/xtl.svg" alt="link">
      </a>
    </div>

    <div id="documenthistory" class="header">
      Document History
    </div>
    <div style='overflow-x:auto;padding-right:0.2em'>
      <table class="tftable">
        <tr><th>Date</th><th>Version</th><th style="min-width:30em">Comment</th></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-03-12</td><td style="text-align:center">0.1</td><td>Initial publishing.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-03-15</td><td style="text-align:center">0.11</td><td>Added external token comment.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-03-29</td><td style="text-align:center">0.12</td><td>Improved replay handling + Changed &quot;Acquirer&quot; to &quot;PSP&quot;.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-04-02</td><td style="text-align:center">0.13</td><td>Added section <a href="#delegatedauthorization">Delegated Authorization</a>.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-04-11</td><td style="text-align:center">0.14</td><td>Added credentialId + more text in <a href="#credentialdatabase">Credential Database</a>.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-04-14</td><td style="text-align:center">0.15</td><td>Added section <a href="#implementationoptions">Implementation Options</a>.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-04-16</td><td style="text-align:center">0.16</td><td>Added sequence diagram &quot;scope&quot; rectangle.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-05-09</td><td style="text-align:center">0.17</td><td>Simplification: Removed hashing of PRCD.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-05-19</td><td style="text-align:center">0.18</td><td>Aligned wallet database with FIDO names.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-06-03</td><td style="text-align:center">0.19</td><td>Added IPR declaration.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-06-21</td><td style="text-align:center">0.20</td><td>Converted the FWP core to CBOR (was JSON).</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-07-02</td><td style="text-align:center">0.21</td><td>Removed redundant FINGERPRINT item.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-08-02</td><td style="text-align:center">0.22</td><td>Added document &quot;FIDO Web Pay - Crypto&quot; and ToC.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-08-27</td><td style="text-align:center">0.23</td><td>Added section <a href="#security">Security Considerations</a>.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2021-09-30</td><td style="text-align:center">0.24</td><td>Added CBOR types in <a href="#credentialdatabase">Credential Database</a>.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2022-02-02</td><td style="text-align:center">0.25</td><td>CBOR date time replaced by text string.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2022-06-15</td><td style="text-align:center">0.26</td><td>CBOR primitives expressed in CDDL notation.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2022-08-18</td><td style="text-align:center">0.27</td><td>CTAP2 signature scheme.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2022-10-03</td><td style="text-align:center">0.28</td><td>Added <code>rpId</code> to <a href="#credentialdatabase">Credential Database</a>.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2022-11-16</td><td style="text-align:center">0.29</td><td>Changed paymentMethod to <code>paymentNetworkId</code>.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2022-12-19</td><td style="text-align:center">0.30</td><td>Changed <code>signature</code> key to <kbd>-1</kbd>.</td></tr>
        <tr><td style="text-align:center;white-space:nowrap">2023-01-07</td><td style="text-align:center">0.31</td><td>Added COTX tag to ESAD object.</td></tr>
      </table>
    </div>
    <div id="authors" class="header">
      Authors
    </div>
    <div>
      The FWP specification is currently authored by Anders Rundgren
      (anders.rundgren.net@gmail.com) on GitHub
        (<a href="https://github.com/fido-web-pay/specification"
            title="GitHub">https://github.com/fido-web-pay/specification<img src="images/xtl.svg" alt="link"></a>).
    </div>
    <div id="trademarks" class="header">
      Trademarks
    </div>
    <div>
      FIDO is a registered trademark of the FIDO alliance.<br>
      EMV is a registered trademark of EMVCo.<br>&nbsp;<br>
      This specification represents an <i>independent effort</i>,
      not associated with the FIDO alliance or EMVCo.
    </div>
</body></html>
