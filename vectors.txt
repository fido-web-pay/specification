|===================================|
| FIDO Web Pay (FWP) - Test Vectors |
|===================================|



User FIDO key in JWK format:
{
  "kty": "EC",
  "crv": "P-256",
  "x": "6BKxpty8cI-exDzCkh-goU6dXq3MbcY0cd1LaAxiNrU",
  "y": "mCbcvUzm44j3Lt2b5BPyQloQ91tf2D2V-gzeUxWaUdg",
  "d": "6XxMFXhcYT5QN9w5TIg2aSKsbcj-pj4BnZkK7ZOt4B8"
}


Merchant 'W3C PaymentRequest' (PRCD) data in pretty-printed JSON notation:
{
  "payee": "Space Shop",
  "id": "7040566321",
  "amount": "435.00",
  "currency": "EUR"
}

Merchant 'hostname' according to the browser: spaceshop.com


Unsigned FWP assertion, here in CBOR 'diagnostic notation':
{
  1: "1.00",
  2: {
    1: "Space Shop",
    2: "7040566321",
    3: "435.00",
    4: "EUR"
  },
  3: "spaceshop.com",
  4: "FR7630002111110020050014382",
  5: "0057162932",
  6: "https://bankdirect.com",
  7: "additional stuff...",
  8: 1,
  9: {
    1: {
      1: "Android",
      2: "10.0"
    },
    2: {
      1: "Chrome",
      2: "103"
    }
  },
  10: 0("2021-06-10T08:34:21+02:00"),
  11: {
    1: -7,
    2: {
      1: 2,
      -1: 1,
      -2: h'e812b1a6dcbc708f9ec43cc2921fa0a14e9d5eadcc6dc63471dd4b680c6236b5',
      -3: h'9826dcbd4ce6e388f72edd9be413f2425a10f75b5fd83d95fa0cde53159a51d8'
    }
  }
}

Note that the last element (11) contains the COSE signature algorithm (ES256) and the FIDO public key (EC/P256) which is also is part of the data to be signed.


The unsigned FWP assertion (binary) converted into a SHA256 hash, here in Base64Url notation:
EF41R_IOu6Imo14riMCp6En54ZPPzUpqaOtLxrBCZYc
This is subsequently used as FIDO 'challenge'.


****************************************
* FIDO/WebAuthn assertion happens here *
****************************************

Returned FIDO 'clientDataJSON', here shown in clear:
{"type":"webauthn.get","origin":"https://fwp.mybank.com","challenge":"EF41R_IOu6Imo14riMCp6En54ZPPzUpqaOtLxrBCZYc"}
Relying party URL: https://fwp.mybank.com

Returned FIDO 'authenticatorData' in hexadecimal notation:
8197e28ff200c8fa383ad36a79ce483c2f5688ddbb2d51502f22c23f60d8e5420100000000
(here using the UP flag and a zero counter value)

Returned FIDO 'signature' in hexadecimal notation:
30450220693d10f97a4e3b3fe34254a75c295b4bd20737843597eb8f752398948e572fe8022100c66c76ab37e0de3de30200d5a4cdabbe50aa0befc8447d654585738347dc9efc

Signed FWP assertion (SAD), here in CBOR 'diagnostic notation':
{
  1: "1.00",
  2: {
    1: "Space Shop",
    2: "7040566321",
    3: "435.00",
    4: "EUR"
  },
  3: "spaceshop.com",
  4: "FR7630002111110020050014382",
  5: "0057162932",
  6: "https://bankdirect.com",
  7: "additional stuff...",
  8: 1,
  9: {
    1: {
      1: "Android",
      2: "10.0"
    },
    2: {
      1: "Chrome",
      2: "103"
    }
  },
  10: 0("2021-06-10T08:34:21+02:00"),
  11: {
    1: -7,
    2: {
      1: 2,
      -1: 1,
      -2: h'e812b1a6dcbc708f9ec43cc2921fa0a14e9d5eadcc6dc63471dd4b680c6236b5',
      -3: h'9826dcbd4ce6e388f72edd9be413f2425a10f75b5fd83d95fa0cde53159a51d8'
    },
    3: h'8197e28ff200c8fa383ad36a79ce483c2f5688ddbb2d51502f22c23f60d8e5420100000000',
    4: h'7b2274797065223a22776562617574686e2e676574222c226f726967696e223a2268747470733a2f2f6677702e6d7962616e6b2e636f6d222c226368616c6c656e6765223a2245463431525f494f7536496d6f313472694d437036456e35345a50507a557071614f744c787242435a5963227d',
    5: h'30450220693d10f97a4e3b3fe34254a75c295b4bd20737843597eb8f752398948e572fe8022100c66c76ab37e0de3de30200d5a4cdabbe50aa0befc8447d654585738347dc9efc'
  }
}

The added elements 3,4,5 represent FIDO's 'authenticatorData','clientDataJSON' and 'signature' respectively.


The signed FWP assertion as a hex-encoded binary: ab0164312e303002a4016a53706163652053686f70026a3730343035363633323103663433352e30300463455552036d737061636573686f702e636f6d04781b465237363330303032313131313130303230303530303134333832056a30303537313632393332067668747470733a2f2f62616e6b6469726563742e636f6d07736164646974696f6e616c2073747566662e2e2e080109a201a20167416e64726f6964026431302e3002a201664368726f6d6502633130330ac07819323032312d30362d31305430383a33343a32312b30323a30300ba5012602a401022001215820e812b1a6dcbc708f9ec43cc2921fa0a14e9d5eadcc6dc63471dd4b680c6236b52258209826dcbd4ce6e388f72edd9be413f2425a10f75b5fd83d95fa0cde53159a51d80358258197e28ff200c8fa383ad36a79ce483c2f5688ddbb2d51502f22c23f60d8e54201000000000458737b2274797065223a22776562617574686e2e676574222c226f726967696e223a2268747470733a2f2f6677702e6d7962616e6b2e636f6d222c226368616c6c656e6765223a2245463431525f494f7536496d6f313472694d437036456e35345a50507a557071614f744c787242435a5963227d05584730450220693d10f97a4e3b3fe34254a75c295b4bd20737843597eb8f752398948e572fe8022100c66c76ab37e0de3de30200d5a4cdabbe50aa0befc8447d654585738347dc9efc


*******************************
* FWP encryption happens here *
*******************************

Issuer encryption key in JWK format:
{
  "kty": "OKP",
  "crv": "X25519",
  "x": "o16U773QQYaQB4eegNCldg6huoIZLsOQIYkFWvbZ5lA",
  "d": "8AMLEwmHm83XsNZ-ZfMxqa4mrPzIuIXOZfQshTJrX2g"
}


Encrypted FWP assertion (ESAD), here in CBOR 'diagnostic notation:
{
  1: 3,
  2: {
    1: -31,
    3: "x25519:2021:3",
    5: {
      1: 1,
      -1: 4,
      -2: h'e0ae21b6bcd3a032eb73c4309ffe617cd4ca2a1a37f42e1429e1c56b1644643a'
    },
    9: h'23980b7a45121222ff78c57a9ff0773533c54154c2bbd0be1d4e067176c627a5978f87fbe376f2a2'
  },
  7: h'22399a8f7dc2a4f2557dd8dda714be82',
  8: h'345e2590a94fe59978669969',
  9: h'98c9210ea29a5fc2c60acd9bf11e149dab51858e063e099cf346e1639f5dffbb422d89dd81786f1960cf5bb4cc2ef9800d2be5671ee3798b191fdfab7e35caf8962a89ebc43899694e4cdc2279c665cabfcb82dfd6bebf24b4fbb22df34e68ae4617f9046695b91ff9afa66bd1fefb2febe4316cafa4b796dba6c086cb0af05c407deaff374c547a4dd87be2cd84a1a389519bb2bed2b7da444bd4716b3c224fee6526712b36d7738915b9be065f494b34ed09f14668b00a45fc97f4f2ca6b8a156a653dea7076fd612978ec16946e564507f355e7710a85327a3b0cbb009d432df5aee2e3cc25fd007cf78cc72b57f00b6965739db6e5728a044f7262c656e5554c4608585e29d89dd5464b2149a1d511ed1546a65f3bbb08c612456b2881757fd05472ab3f14590d5b6da0bf4ec5bac439756058914e61ba4598b1958d4c516a65c4c5bd4e228f581c109ec6f2677aeb8419d0ab4a0a1a4733add89dc7b1f62f1dfa4acb0f12b0d58595f893da9eb4c65e00bb9055ceb2dac7fd02a200e6e735e337300c155aeb8fbf1f3883acfc95f9c192e88473a4748c41e7cc905c880f6948e0883cabc39a80ac0c7263c834623fe21df03a3f815b91bbacbe11878abb9155f9eac73682d2e85d264ae7d1cb6a3ae509c3390fcd77d99e2ecded48e9b5389c9915eafe81fda69f7cb8e4deb8f887b069ff268e57a01b3c3dc9ac51f3094dfc0189373d11ffbbcf1c15db'
}

And as a hex-encoded binary: a5010302a401381e036d7832353531393a323032313a3305a301012004215820e0ae21b6bcd3a032eb73c4309ffe617cd4ca2a1a37f42e1429e1c56b1644643a09582823980b7a45121222ff78c57a9ff0773533c54154c2bbd0be1d4e067176c627a5978f87fbe376f2a2075022399a8f7dc2a4f2557dd8dda714be82084c345e2590a94fe599786699690959020d98c9210ea29a5fc2c60acd9bf11e149dab51858e063e099cf346e1639f5dffbb422d89dd81786f1960cf5bb4cc2ef9800d2be5671ee3798b191fdfab7e35caf8962a89ebc43899694e4cdc2279c665cabfcb82dfd6bebf24b4fbb22df34e68ae4617f9046695b91ff9afa66bd1fefb2febe4316cafa4b796dba6c086cb0af05c407deaff374c547a4dd87be2cd84a1a389519bb2bed2b7da444bd4716b3c224fee6526712b36d7738915b9be065f494b34ed09f14668b00a45fc97f4f2ca6b8a156a653dea7076fd612978ec16946e564507f355e7710a85327a3b0cbb009d432df5aee2e3cc25fd007cf78cc72b57f00b6965739db6e5728a044f7262c656e5554c4608585e29d89dd5464b2149a1d511ed1546a65f3bbb08c612456b2881757fd05472ab3f14590d5b6da0bf4ec5bac439756058914e61ba4598b1958d4c516a65c4c5bd4e228f581c109ec6f2677aeb8419d0ab4a0a1a4733add89dc7b1f62f1dfa4acb0f12b0d58595f893da9eb4c65e00bb9055ceb2dac7fd02a200e6e735e337300c155aeb8fbf1f3883acfc95f9c192e88473a4748c41e7cc905c880f6948e0883cabc39a80ac0c7263c834623fe21df03a3f815b91bbacbe11878abb9155f9eac73682d2e85d264ae7d1cb6a3ae509c3390fcd77d99e2ecded48e9b5389c9915eafe81fda69f7cb8e4deb8f887b069ff268e57a01b3c3dc9ac51f3094dfc0189373d11ffbbcf1c15db
