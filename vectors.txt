|===================================|
| FIDO Web Pay (FWP) - Test Vectors |
|===================================|



User FIDO key in JWK format:
{
  "kty": "EC",
  "crv": "P-256",
  "x": "6BKxpty8cI-exDzCkh-goU6dXq3MbcY0cd1LaAxiNrU",
  "y": "mCbcvUzm44j3Lt2b5BPyQloQ91tf2D2V-gzeUxWaUdg",
  "d": "6XxMFXhcYT5QN9w5TIg2aSKsbcj-pj4BnZkK7ZOt4B8"
}


Merchant 'W3C PaymentRequest' (PRCD) data in pretty-printed JSON notation:
{
  "payee": "Space Shop",
  "id": "7040566321",
  "amount": "435.00",
  "currency": "EUR"
}

Merchant 'hostname' according to the browser: spaceshop.com


Unsigned FWP assertion, here in CBOR 'diagnostic notation':
{
  1: "1.0",
  2: {
    1: "Space Shop",
    2: "7040566321",
    3: "435.00",
    4: "EUR"
  },
  3: "spaceshop.com",
  4: "FR7630002111110020050014382",
  5: "0057162932",
  6: "https://bankdirect.com",
  7: "additional stuff...",
  8: 1,
  9: {
    1: {
      3: "Android",
      4: "10.0"
    },
    2: {
      3: "Chrome",
      4: "103"
    }
  },
  10: 0("2021-06-10T08:34:21+02:00"),
  11: {
    1: -7,
    2: {
      1: 2,
      -1: 1,
      -2: h'e812b1a6dcbc708f9ec43cc2921fa0a14e9d5eadcc6dc63471dd4b680c6236b5',
      -3: h'9826dcbd4ce6e388f72edd9be413f2425a10f75b5fd83d95fa0cde53159a51d8'
    }
  }
}

Note that the last element (11) contains the COSE signature algorithm (ES256) and the FIDO public key (EC/P256) which is also is part of the data to be signed.


The unsigned FWP assertion (binary) converted into a SHA256 hash, here in Base64Url notation:
wex6Vw7FuNUMonfkwvOMNaHOD8wYFAZesFgMUV-42eE
This is subsequently used as FIDO 'challenge'.


****************************************
* FIDO/WebAuthn assertion happens here *
****************************************

Returned FIDO 'clientDataJSON', here shown in clear:
{"type":"webauthn.get","origin":"https://mybank.fr","challenge":"wex6Vw7FuNUMonfkwvOMNaHOD8wYFAZesFgMUV-42eE"}
Relying party URL: https://mybank.fr

Returned FIDO 'authenticatorData' in hexadecimal notation:
412e175a0f0bdc06dabf0b1db79b97541c08dbacee7e31c97a553588ee922ea70100000000
(here using the UP flag and a zero counter value)

Returned FIDO 'signature' in hexadecimal notation:
304502203ab227e34f66a90d061bbe0a27797591e9e9188e8017bd9f940902d5ed5b296c022100fd365bec8145de7146de5e282f2030a8502cb05316cbf6f1f77daa55b5132d09

Signed FWP assertion (SAD), here in CBOR 'diagnostic notation':
{
  1: "1.0",
  2: {
    1: "Space Shop",
    2: "7040566321",
    3: "435.00",
    4: "EUR"
  },
  3: "spaceshop.com",
  4: "FR7630002111110020050014382",
  5: "0057162932",
  6: "https://bankdirect.com",
  7: "additional stuff...",
  8: 1,
  9: {
    1: {
      3: "Android",
      4: "10.0"
    },
    2: {
      3: "Chrome",
      4: "103"
    }
  },
  10: 0("2021-06-10T08:34:21+02:00"),
  11: {
    1: -7,
    2: {
      1: 2,
      -1: 1,
      -2: h'e812b1a6dcbc708f9ec43cc2921fa0a14e9d5eadcc6dc63471dd4b680c6236b5',
      -3: h'9826dcbd4ce6e388f72edd9be413f2425a10f75b5fd83d95fa0cde53159a51d8'
    },
    3: h'412e175a0f0bdc06dabf0b1db79b97541c08dbacee7e31c97a553588ee922ea70100000000',
    4: h'7b2274797065223a22776562617574686e2e676574222c226f726967696e223a2268747470733a2f2f6d7962616e6b2e6672222c226368616c6c656e6765223a227765783656773746754e554d6f6e666b77764f4d4e61484f4438775946415a657346674d55562d34326545227d',
    5: h'304502203ab227e34f66a90d061bbe0a27797591e9e9188e8017bd9f940902d5ed5b296c022100fd365bec8145de7146de5e282f2030a8502cb05316cbf6f1f77daa55b5132d09'
  }
}

The added elements 3,4,5 represent FIDO's 'authenticatorData','clientDataJSON' and 'signature' respectively.


The signed FWP assertion as a hex-encoded binary: ab0163312e3002a4016a53706163652053686f70026a3730343035363633323103663433352e30300463455552036d737061636573686f702e636f6d04781b465237363330303032313131313130303230303530303134333832056a30303537313632393332067668747470733a2f2f62616e6b6469726563742e636f6d07736164646974696f6e616c2073747566662e2e2e080109a201a20367416e64726f6964046431302e3002a203664368726f6d6504633130330ac07819323032312d30362d31305430383a33343a32312b30323a30300ba5012602a401022001215820e812b1a6dcbc708f9ec43cc2921fa0a14e9d5eadcc6dc63471dd4b680c6236b52258209826dcbd4ce6e388f72edd9be413f2425a10f75b5fd83d95fa0cde53159a51d8035825412e175a0f0bdc06dabf0b1db79b97541c08dbacee7e31c97a553588ee922ea7010000000004586e7b2274797065223a22776562617574686e2e676574222c226f726967696e223a2268747470733a2f2f6d7962616e6b2e6672222c226368616c6c656e6765223a227765783656773746754e554d6f6e666b77764f4d4e61484f4438775946415a657346674d55562d34326545227d055847304502203ab227e34f66a90d061bbe0a27797591e9e9188e8017bd9f940902d5ed5b296c022100fd365bec8145de7146de5e282f2030a8502cb05316cbf6f1f77daa55b5132d09


*******************************
* FWP encryption happens here *
*******************************

Issuer encryption key in JWK format:
{
  "kty": "OKP",
  "crv": "X25519",
  "x": "o16U773QQYaQB4eegNCldg6huoIZLsOQIYkFWvbZ5lA",
  "d": "8AMLEwmHm83XsNZ-ZfMxqa4mrPzIuIXOZfQshTJrX2g"
}


Encrypted FWP assertion (ESAD), here in CBOR 'diagnostic notation:
{
  1: 3,
  2: {
    1: -31,
    3: "x25519:2021:3",
    5: {
      1: 1,
      -1: 4,
      -2: h'9cace2b4e8c482c92a14a995edaa664f2c267fb7fbb20d7020d675fa83b50501'
    },
    9: h'172b5e4a1f0e5c2fb2003438d789cdf8f3f5a53977f550c6b96ed3ab5ec6541f0e82cab0e5f6fe83'
  },
  7: h'fc21bedc42f2991b3c49021a4251ac15',
  8: h'df60199e6b866b8838be983a',
  9: h'a0c644d5af75d5e0ee284274539ff45fc9eee5c987bec9e592ce54a5eae57dc87c782c3cf12e1a7a7fb74900df86970893affd278cdee4603418d5d6d7609030b29140da1608734421a363b56b154c75bd1e8b0cb7338b40c2aacc4a6600027cb5fa82e8dce5b4e28040057bac760a7e2dfca84e1274a51275048d6edc2e4796979f4b9796ed0d03c4fa8ee99b0831cda076825ba7008160f3be2fdf560a2999c2ad8f5466a98457246619dd716476259f6acc15057e8fe1f3c3cd62564809d12cd4db46f2a87c313cade70ae8904dd42ee3725c331e65c9a4c7437350792257c2fab493663037a7432c357dd2fe36f7b2129a78728a64062b5efdf7bdd98bde0fd57a88f1a8f1298c234fe8cfce544beea3ecf59eec8e2c7ca61fa663534a2de57be6d2d96a0c5d5d284c28f3af34ee5da0fa007ab28ccd1c1ec05ddc535e564556249fb47373f9e7e32cfef0c0e7bbe8cc276d4b2103e75115a95818c307253c7866634ed8d54ea756543723847ff1d1a391ac685746664fad063bbc6c60fbae46ca2f667401ae6c259175264af75cf71d56c35b23b501637d6181af45de44457d76afe53a99b1c2e324c3861dc9d1b5c80c3d24242433d947590346f55389ed4f879a8474259b1795d4d1073be8d112bdbbdee18a0ca324797cc329eb6a72075ad18b8a9294e6f08435dc04483655619ebde497542f45fedb909409ea1155e85f0105f7e5c5'
}

And as a hex-encoded binary: a5010302a401381e036d7832353531393a323032313a3305a3010120042158209cace2b4e8c482c92a14a995edaa664f2c267fb7fbb20d7020d675fa83b50501095828172b5e4a1f0e5c2fb2003438d789cdf8f3f5a53977f550c6b96ed3ab5ec6541f0e82cab0e5f6fe830750fc21bedc42f2991b3c49021a4251ac15084cdf60199e6b866b8838be983a09590207a0c644d5af75d5e0ee284274539ff45fc9eee5c987bec9e592ce54a5eae57dc87c782c3cf12e1a7a7fb74900df86970893affd278cdee4603418d5d6d7609030b29140da1608734421a363b56b154c75bd1e8b0cb7338b40c2aacc4a6600027cb5fa82e8dce5b4e28040057bac760a7e2dfca84e1274a51275048d6edc2e4796979f4b9796ed0d03c4fa8ee99b0831cda076825ba7008160f3be2fdf560a2999c2ad8f5466a98457246619dd716476259f6acc15057e8fe1f3c3cd62564809d12cd4db46f2a87c313cade70ae8904dd42ee3725c331e65c9a4c7437350792257c2fab493663037a7432c357dd2fe36f7b2129a78728a64062b5efdf7bdd98bde0fd57a88f1a8f1298c234fe8cfce544beea3ecf59eec8e2c7ca61fa663534a2de57be6d2d96a0c5d5d284c28f3af34ee5da0fa007ab28ccd1c1ec05ddc535e564556249fb47373f9e7e32cfef0c0e7bbe8cc276d4b2103e75115a95818c307253c7866634ed8d54ea756543723847ff1d1a391ac685746664fad063bbc6c60fbae46ca2f667401ae6c259175264af75cf71d56c35b23b501637d6181af45de44457d76afe53a99b1c2e324c3861dc9d1b5c80c3d24242433d947590346f55389ed4f879a8474259b1795d4d1073be8d112bdbbdee18a0ca324797cc329eb6a72075ad18b8a9294e6f08435dc04483655619ebde497542f45fedb909409ea1155e85f0105f7e5c5


FWP assertion delivered by the browser:
{
  "paymentMethod": "https://bankdirect.com",
  "issuerId": "https://mybank.fr/payment",
  "encryptedAuthorization": "pQEDAqQBOB4DbXgyNTUxOToyMDIxOjMFowEBIAQhWCCcrOK06MSCySoUqZXtqmZPLCZ_t_uyDXAg1nX6g7UFAQlYKBcrXkofDlwvsgA0ONeJzfjz9aU5d_VQxrlu06texlQfDoLKsOX2_oMHUPwhvtxC8pkbPEkCGkJRrBUITN9gGZ5rhmuIOL6YOglZAgegxkTVr3XV4O4oQnRTn_Rfye7lyYe-yeWSzlSl6uV9yHx4LDzxLhp6f7dJAN-GlwiTr_0njN7kYDQY1dbXYJAwspFA2hYIc0Qho2O1axVMdb0eiwy3M4tAwqrMSmYAAny1-oLo3OW04oBABXusdgp-LfyoThJ0pRJ1BI1u3C5HlpefS5eW7Q0DxPqO6ZsIMc2gdoJbpwCBYPO-L99WCimZwq2PVGaphFckZhndcWR2JZ9qzBUFfo_h88PNYlZICdEs1NtG8qh8MTyt5wrokE3ULuNyXDMeZcmkx0NzUHkiV8L6tJNmMDenQyw1fdL-NveyEpp4copkBite_fe92YveD9V6iPGo8SmMI0_oz85US-6j7PWe7I4sfKYfpmNTSi3le-bS2WoMXV0oTCjzrzTuXaD6AHqyjM0cHsBd3FNeVkVWJJ-0c3P55-Ms_vDA57vozCdtSyED51EVqVgYwwclPHhmY07Y1U6nVlQ3I4R_8dGjkaxoV0ZmT60GO7xsYPuuRsovZnQBrmwlkXUmSvdc9x1Ww1sjtQFjfWGBr0XeREV9dq_lOpmxwuMkw4YdydG1yAw9JCQkM9lHWQNG9VOJ7U-HmoR0JZsXldTRBzvo0RK9u97higyjJHl8wynranIHWtGLipKU5vCENdwESDZVYZ695JdUL0X-25CUCeoRVehfAQX35cU"
}
