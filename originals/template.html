<!DOCTYPE html><html><head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<link rel='icon' href='images/favicon.png' sizes='192x192'>
<title>FIDO Web Pay</title><style type='text/css'>
.header {font-size:1.5em;margin:1em 0 0.8em 0}
.para {margin-top: 0.8em}
.actor {color:darkgreen;font-weight:bolder}
.box {box-shadow: 0.2em 0.2em 0.2em #d0d0d0;border-width:1px;border-style:solid;border-color:black}
.numbox {border-width: 1pt;border-style:solid;border-color:black;border-radius:0.3em;display:inline-block;margin: 1.5em 0.6em 0.6em 0;padding: 0 3pt 0.1em 3pt}
.tftable {border-collapse:collapse;box-shadow:0.3em 0.3em 0.3em #d0d0d0;margin-bottom:0.3em} 
.tftable td {white-space:nowrap;background-color:#ffffe0;padding:0.4em 0.5em;border-width:1px;border-style:solid;border-color:#a9a9a9}
.tftable th {white-space:nowrap;padding:0.4em 0.5em;background:linear-gradient(to bottom, #eaeaea 14%,#fcfcfc 52%,#e5e5e5 89%);text-align:center;border-width:1px;border-style:solid;border-color:#a9a9a9}
.json {word-break:break-all;background-color:#f8f8f8;padding:1em;border-width:1px;border-style:solid;border-color:#a9a9a9;box-shadow:0.3em 0.3em 0.3em #d0d0d0}
body {margin:1em;font-size:10pt;font-family:Verdana,'Bitstream Vera Sans','DejaVu Sans',Arial,'Liberation Sans';background-color:white} 
code {font-size:10pt}
.reserved {color:maroon;font-weight:bold}
ul {margin:0}
li {margin-top:0.3em}
a {color:blue;text-decoration:none}
</style>
</head>
<body>
  <img style='max-width:50%' src='images/fwp.svg' alt='logo' title='FWP logotype'>
  <div id='introduction' class='header'>Introduction</div>
  <div>
    <a href='https://www.emvco.com/' title='EMVCo Site'>EMV&reg;<img src='images/xtl.svg' alt='link'></a> represents
    the current &quot;Gold Standard&quot; for <i>secure and convenient payments</i>
    in the physical world.
  </div>
  <div class='para'>
    This document describes FIDO&reg; Web Pay (FWP), which is a Web-adapted version of EMV,
    building on the technology underpinning <a href='https://fidoalliance.org/fido2/'
                             title='FIDO2 Technology'>FIDO2<img src='images/xtl.svg' alt='link'></a>
    combined with the W3C
    <a href='https://www.w3.org/TR/payment-request/'
       title='PaymentRequest'>PaymentRequest<img src='images/xtl.svg' alt='link'></a> API.
  </div>
  <div class='para'>
    Through an extension to EMV, FWP can be applied to <i>any account-based payment system</i>,
    including the eurozone's
    <a href='https://www.europeanpaymentscouncil.eu/'
       title='European Payments Council'>SEPA Instant<img src='images/xtl.svg' alt='link'></a>.
  </div>
  <div class='para'>
     Apart from obvious data format differences (JSON/JavaScript versus ISO7816), the primary technical
enhancement to EMV, is that the FWP client <i>encrypts</i> user-authorizations
in order to accomplish the following subgoals:
  <ul>
    <li>
      Eliminate dependencies on external tokenization services.
    </li>
    <li>
      Limit the amount of personally identifiable information (PII), shared
      with <i>third parties</i>, to the name of the user's bank.
      This is presumably compliant with
      <a href='https://www.pcisecuritystandards.org'
         title='PCI Site'>PCI<img src='images/xtl.svg' alt='link'></a>
      requirements as well as with <a href='https://gdprinfo.eu/'
title='GDPR Site'>GDPR<img src='images/xtl.svg' alt='link'></a>.
    </li>
    <li>
      Separate the formats for account numbers and issuer (bank branch) identifiers.
      The latter should preferably be expressed as URLs, removing the need for externally managed
      databases holding issuer payment processor end-points.
    </li>
  </ul>
</div>
  <div id='scope' class='header'>
    Scope
  </div>
  <div>
    Note that FWP is not a payment system, it is a <i>payment authorization</i> scheme,
    exclusively dealing with the <i>user's</i> part of the payment process.
    That is, the backend infrastructure and associated APIs are out of scope for this specification
    and are therefore only described at a &quot;conceptual&quot; level.
    Note though that regardless of the backend design, FWP assertions
    MUST (due to the EMV <i>end-2-end security model</i>),
    always be routed back to the designated issuer &quot;verbatim&quot;
    (together with other required data) in order to initiate a payment transaction.
  </div>
  <div class='para'>
    It is assumed that <i>at this stage in time</i>,
    backend infrastructures will be <i>independently defined</i> by each payment network
    rather than becoming a unified standard.  Also see <a href="#integration">Integration</a>.
  </div>
  <div id='terminology' class='header'>
    Terminology
  </div>
  <div>
    Throughout the rest of this document, actor names are
    written as <span class='actor'>Actor Name</span>.
    The <span class='actor'>Browser</span> actor is in this specification
    considered to be equivalent to &quot;User Agent&quot;.
    An <span class='actor'>Acquirer</span> is in this specification
    denoting any service or network acting as a <i>trusted intermediary</i> between
    a <span class='actor'>Merchant</span> and an <span class='actor'>Issuer</span>.
  </div>
  <div id='prerequisites' class='header'>
    Prerequisites
  </div>
  <div>
    The steps outlined in <a href='#operation'>Detailed Operation</a>
 depend on that the <span class='actor'>User</span> already has received
    one or more <i>payment credentials</i> in an <a href='#enrollment'>Enrollment</a> process.
    A payment credential is supposed to at least contain the following elements:
    <ul>
      <li>An identifier to a <span class='actor'>User</span> specific (<i>unique</i>) FIDO key for <i>signing</i> payment authorization data.</li>
      <li>An <span class='actor'>Issuer</span> specific (<i>shared</i>) public key for <i>encrypting</i> payment authorization data.</li>
      <li>An <code class='reserved'>accountId</code> associated with the FIDO signature key.</li>
      <li>A <code class='reserved'>paymentMethod</code> URL identifying the FWP method for a particular payment network.</li>
      <li>An <code class='reserved'>issuerId</code> in the form of a
Bank Identification Number (BIN) or URL associated with the <span class='actor'>Issuer</span>.</li>
      <li>An icon identifying the payment credential for the <span class='actor'>User</span>.</li>
    </ul>
  </div>
  <div class='para box' style='padding:0.5em 1em;margin-top:1em;display:inline-block'>
    Note that FWP effectively forms a browser-resident &quot;Wallet&quot;,
    holding any number of payment credentials, each representing a specific <span class='actor'>Issuer</span>
    and <code class='reserved'>paymentMethod</code>.
  </div>
  <div id='enrollment' class='header'>
    Enrollment
  </div>
  <div>
    The exact enrollment process is yet to be defined; the assumption is that it
    could be accomplished by extending the existing W3C
    <a href='https://www.w3.org/TR/webauthn-2/' 
title='Web Authentication'>Web&nbsp;Authentication<img src='images/xtl.svg' alt='link'></a> enrollment system.
    The extension would enable the <span class='actor'>Browser</span> 
to securely distinguish between &quot;ordinary&quot; FIDO keys,
    and those targeted for payments which is required for maintaining
 a <i>database</i> in the <span class='actor'>Browser</span> holding FWP credentials.
  </div>
  <div class='para'>
    It MAY be technically feasible using a FIDO key associated with an FWP credential
for Web Authentication as well, but this would be a deployment decision
by the <span class='actor'>Issuer</span>.
  </div>
  <div id='operation' class='header'>
    Detailed Operation
  </div>
  <div>This section describes the different steps needed to authorize a payment operation using FWP.
The foundation for the description is the following sequence diagram where each step
is linked to a <i>clickable</i> number in a box:
</div>
  <div style='overflow-x:auto;padding:8pt 0'>
    @statediagram@
  </div>
<div>Note that this specification does not elaborate on the return data from
the <b class='actor'>Acquirer</b> and <b class='actor'>Issuer</b>,
 because this is payment network specific.</div>
<div id='step1' class='numbox'>1</div>Initiate PaymentRequest
<div>In this step the <b class='actor'>Merchant</b></div>
 <div style='overflow-x:auto;padding:8pt 0'>
<pre style="margin:0">
const methodData = [{
  supportedMethods: 'https://emvco.com/spc/visa'
},{
  supportedMethods: 'https://emvco.com/spc/mastercard'
},{  
  supportedMethods: 'https://europeanpaymentsinitiative.eu/spc'
}];

const request = new PaymentRequest(methodData,{
  id: '7040566321',   // Mandatory for SPC
  total: {label: null, amount: {currency: 'EUR', value: '435.00'}},
  payee: 'Space Shop'   // Possible API enhancement
});

const response = await request.show();
await response.complete('success');
</pre>
</div>
<div id='step2' class='numbox'>2</div>Show Payment Authorization UI
<div style='margin-bottom:0.8em'>In this step the <b class='actor'>Browser</b> responds with
a payment authorization UI like the following:</div>
  <div style='overflow-x:auto;padding-bottom:5pt'>
    <img style='display:block;width:220pt;box-shadow:2pt 2pt 3pt #808080;border-width:1pt;border-style:solid;border-color:darkgrey' alt='Payment UI' src='images/ui.svg'>
  </div>
  <div>Non-normative UI in &quot;dark mode&quot;.</div>
  <div class='para'>
    If the <b class='actor'>User</b> have no matching payment credentials (&quot;Virtual Cards&quot;),
   the <b class='actor'>Browser</b> MUST indicate that and give the <b class='actor'>User</b>
an option to return to the <b class='actor'>Merchant</b> &quot;Checkout&quot; page.
  </div>
  <div class='para'>
    If the <b class='actor'>User</b> have multiple matching payment credentials,
    the <b class='actor'>Browser</b> MUST provide a way to select a specific credential.
    In the sample UI shown above, the <b class='actor'>User</b>
    can swipe credentials to the left and right, while arrow symbols are used to show if there
    are more credentials available.  That is, if there is no arrow, the credential selector is
at an end point.
  </div>
<div id='step3' class='numbox'>3</div>User Authorization
<div>In this step the <b class='actor'>User</b>
<i>authorizes</i> the request with a fingerprint, PIN, or similar.
A successful user authorization causes the next step to be performed.</div>
<div id='step4' class='numbox'>4</div>Create FWP Assertion
<div>In this step the <b class='actor'>Browser</b>
creates an FWP assertion which requires the following operations:</div>
<div id="3.1"class='para'>
3.1 Blahm blah
</div>
<div id='step5' class='numbox'>5</div>Return FWP Assertion
<div>In this step the <b class='actor'>Browser</b>
returns the completed FWP assertion to the
<b class='actor'>Merchant</b> through the ? </div>
<div id='step6' class='numbox'>6</div>
<div>In this step the <b class='actor'>Merchant</b></div>
<div id='step7' class='numbox'>7</div>
<div>In this step the <b class='actor'>Merchant</b></div>
<div id='step8' class='numbox'>8</div>
<div>In this step the <b class='actor'>Merchant</b></div>
<div id='step9' class='numbox'>9</div>
<div>In this step the <b class='actor'>Merchant</b></div>
<div id='step10' class='numbox'>10</div>
<div>In this step the <b class='actor'>Merchant</b></div>

<div id='integration' class='header'>
Integration
</div>
<div>
It is obvious that the integration of systems like FWP in payment networks
is crucial for acceptance by the market.
</div>
<div class="para">
  For card based payments FWP implementations can build on the existing
  EMV foundation since essentially only the formats differ.
  Although the lack of a PAN (card number) in FWP may appear as a major obstacle,
  the <code class='reserved'>issuerId</code> would in this case hold a &quot;neutered&quot; PAN where
  the BIN (Bank Identification Number) is set, while the rest are set to zeroes + Luhn check digit.
  E.g. VISA: 4972039000000004.  However, using <b class='actor'>Issuer</b> URLs
  is also a viable alternative for card payments because the payment processors
  associated with &quot;regular&quot; EMV and FWP payments do probably not
  use the same end point.
</div>  
<div class="para">
  For account-to-account payments there are currently no generally agreed upon standards
  for consumer payments, making it hard to come up with FWP implementation guidlines.
  Remapping existing card based systems and infrastructures seems though like a possible path.
</div>
<div class="para">
  Open Banking may though become a factor because there is work under way making non-OAuth2
  requests a part of Open Banking APIs.  There are good reasons for that since current Open Banking
  payment APIs presume that the <b class='actor'>User</b> in some OOB way informs the
  <b class='actor'>Merchant</b> who their <b class='actor'>Issuer</b> is, which becomes
  quite impractical when the number of issuers grow.  In an Open Banking scenario powered by FWP,
  a Payment Initiation Service Provider (PISP) would effectively perform the same tasks as a
  traditional <b class='actor'>Acquirer</b>, albeit regulated.  That is, there would unlikely
  be any <b class='actor'>User</b> interactions with such a PISP.
</div>
<div id='extensions' class='header'>
Extensions
</div>
<div>
The FWP core is loosely derived from a PoC system known as  
<a href='https://cyberphone.github.io/doc/saturn/' 
title='Saturn'>Saturn<img src='images/xtl.svg' alt='link' /></a>.
By building on this core, Saturn features like the following could potentially be added:
<ul style='margin-bottom:0.3em'>
  <li>
    Support for <i>non-direct payments</i>,
    including secure (<i>tokenized</i>) versions of Card-on-File.
</li>
<li>
  Support for universal digital receipts.
</li>
<li>
  Support for private messaging and additional authentication information between the
 <b class='actor'>Issuer</b> and <b class='actor'>User</b>.
</li>
</ul>
Not though that the features above would have implications on the PaymentRequest API. 
</div>
<div class='para'>
A radical change would be moving the FWP implementation down into the client platform layer.
This would open FWP to other payment scenarios like point-of-sale (PoS) and person-to-person (P2P).
It would also make it considerably easier for alternative browser vendors adopting the FWP system.
</div>
<div id='acknowledgements' class='header'>
  Acknowledgements
</div>
<div>
The FWP core was heavily influenced by an earlier Microsoft research project
called <a href='https://en.wikipedia.org/wiki/Windows_CardSpace'
title='CardSpace'>Windows CardSpace<img src='images/xtl.svg' alt='link'></a>.
</div>
<div id='version' class='header'>
  Version
</div>
<div>
Document version: 0.1, 2020-03-09
</div>
<div id='authors' class='header'>
  Authors
</div>
<div>
The FWP specification is currently authored by Anders Rundgren (<code>anders.rundgren.net@gmail.com</code>).<br/>
</div>
<div class='header'>
  Trademarks
</div>
<div id='trademarks'>
  FIDO is a registered trademark of the FIDO alliance.<br/>
  EMV is a registered trademark of EMVCo.<br/>&nbsp;<br/>
  This specification represents an <i>independent effort</i>, not associated with the FIDO alliance or EMVCo.
</div>
</body></html>
